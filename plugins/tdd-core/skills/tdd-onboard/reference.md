# TDD Onboard Reference

詳細なワークフローとテンプレート。

## Step 1: プロジェクト分析

### 1.1 フレームワーク検出

| 検出対象 | フレームワーク |
|---------|--------------|
| `artisan` | Laravel |
| `app.py` または `wsgi.py` | Flask |
| `manage.py` + django依存 | Django |
| `wp-config.php` | WordPress |
| 上記以外 | Generic |

### 1.2 パッケージマネージャ検出

| 検出対象 | パッケージマネージャ |
|---------|-------------------|
| `composer.json` | Composer (PHP) |
| `poetry.lock` | Poetry (Python) |
| `uv.lock` | uv (Python) |
| `package.json` | npm/yarn/pnpm |

### 1.3 テストツール検出

| フレームワーク | テストツール | カバレッジ | 静的解析 | フォーマッター |
|--------------|-------------|----------|---------|--------------|
| Laravel | PHPUnit/Pest | `php artisan test --coverage` | PHPStan | Pint |
| Flask | pytest | `pytest --cov` | mypy | black |
| Django | pytest | `pytest --cov` | mypy | black |
| WordPress | PHPUnit | `phpunit --coverage-text` | PHPStan | WPCS |

---

## Step 3: docs/ 構造

### docs/README.md テンプレート

```markdown
# Documentation Index

## プロジェクト状況

現在の状況は [STATUS.md](STATUS.md) を参照。

## TDD サイクル

サイクルドキュメントは `docs/cycles/` に格納されています。

**命名規則**: `YYYYMMDD_HHMM_機能名.md`

## ドキュメント一覧

- 設計・調査は `docs/` 直下に格納
- TDD サイクルは `docs/cycles/` に格納
```

### docs/STATUS.md テンプレート

```markdown
# Project Status

最終更新: ${DATE}

## 進行中

なし

## バックログ

GitHub Issues を参照: `gh issue list`

## 最近完了

なし

---

*このファイルは tdd-commit で自動更新されます*
```

---

## Step 4: CLAUDE.md 生成

### マージ戦略

| セクション | 戦略 |
|-----------|------|
| Overview | 既存を保持 |
| Tech Stack | 新規で上書き |
| Quick Commands | 新規で上書き |
| TDD Workflow | 新規で上書き |
| Quality Standards | 新規で上書き |
| Project Structure | 既存を保持 |
| カスタムセクション | 既存を保持 |

### CLAUDE.md テンプレート

```markdown
# ${PROJECT_NAME}

## Overview

[プロジェクトの目的を2-3文で記述]

---

## Tech Stack

- **Language**: ${LANGUAGE}
- **Framework**: ${FRAMEWORK}
- **Test**: ${TEST_TOOL}
- **Static Analysis**: ${STATIC_ANALYSIS}
- **Formatter**: ${FORMATTER}

---

## Quick Commands

\`\`\`bash
# テスト
${TEST_COMMAND}

# カバレッジ
${COVERAGE_COMMAND}

# 静的解析
${STATIC_ANALYSIS_COMMAND}

# フォーマット
${FORMATTER_COMMAND}
\`\`\`

---

## TDD Workflow

すべての機能開発・バグ修正はTDDサイクルを通す。

\`\`\`
INIT → PLAN → RED → GREEN → REFACTOR → REVIEW → COMMIT
\`\`\`

**絶対ルール**: エラーを見つけたら、まずテストを書く

---

## Quality Standards

| 指標 | 目標 |
|------|------|
| カバレッジ | 90%以上（最低80%） |
| 静的解析 | エラー0件 |
| フォーマット | 規約準拠 |

---

## Project Structure

\`\`\`
${PROJECT_STRUCTURE}
\`\`\`

---

*Generated by tdd-onboard*
```

---

## Step 5: agent_docs/

### tdd_workflow.md

```markdown
# TDD Workflow Guide

## 7フェーズ概要

INIT → PLAN → RED → GREEN → REFACTOR → REVIEW → COMMIT

## 各フェーズの詳細

### INIT（初期化）
- TDDサイクルの開始宣言
- Cycle doc作成

### PLAN（計画）
- スコープ定義
- テストリスト作成

### RED（失敗するテスト）
- テストコード作成
- 失敗を確認

### GREEN（最小実装）
- テストを通す最小限のコード

### REFACTOR（リファクタリング）
- コード品質改善
- テスト維持

### REVIEW（品質検証）
- 品質チェック実行

### COMMIT（コミット）
- Git commit
- STATUS.md更新

## 絶対ルール

「エラーを見つけたら、まずテストを書く」
```

---

## Step 6: 初期Cycle doc

```markdown
---
feature: setup
cycle: project-setup-001
phase: INIT
created: ${DATE}
updated: ${DATE}
---

# プロジェクト TDD セットアップ

## やりたいこと

プロジェクトの TDD 環境を確認し、品質基準を満たす状態を把握する。

---

## 確認項目

1. 既存テストが全て通過するか
2. 現在のカバレッジ率
3. 静的解析エラー数
4. コードフォーマット状態

---

## Test List

- [ ] 既存テストが全て通過する
- [ ] カバレッジ率を記録: ___%
- [ ] 静的解析エラー数: ___件
- [ ] フォーマット: OK / NG
```

---

## 変数一覧

| 変数名 | 説明 | 例 |
|--------|------|-----|
| `${PROJECT_NAME}` | プロジェクト名 | my-app |
| `${FRAMEWORK}` | フレームワーク | Laravel, Flask |
| `${TEST_TOOL}` | テストツール | PHPUnit, pytest |
| `${TEST_COMMAND}` | テスト実行 | php artisan test |
| `${COVERAGE_COMMAND}` | カバレッジ | php artisan test --coverage |
| `${STATIC_ANALYSIS}` | 静的解析 | PHPStan, mypy |
| `${FORMATTER}` | フォーマッター | Pint, black |

---

## エラーハンドリング

| 状況 | 対応 |
|------|------|
| フレームワーク検出失敗 | AskUserQuestion で確認 |
| 既存 CLAUDE.md あり | バックアップ + マージ確認 |
| poetry/uv 判別不可 | ユーザーに確認 |
