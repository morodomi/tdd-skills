---
name: tdd-refactor
description: テストを維持しながらコード品質を改善する。GREENの次フェーズ。「リファクタして」「refactor」で起動。
---

# TDD REFACTOR Phase

テストを維持しながらコード品質を改善する。

## Progress Checklist

コピーして進捗を追跡:

```
REFACTOR Progress:
- [ ] 最新Cycle doc確認
- [ ] 現在のテストが全てPASSすることを確認
- [ ] リファクタリング実施
- [ ] テスト実行→成功確認
- [ ] Cycle doc更新
- [ ] REVIEWフェーズへ誘導
```

## 禁止事項

- テストを壊す変更
- 新機能の追加（次のサイクルで）
- テストの削除・変更

## Workflow

### Step 1: Cycle doc確認

```bash
ls -t docs/cycles/*.md 2>/dev/null | head -1
```

### Step 2: テスト確認

```bash
php artisan test  # PHP
pytest            # Python
```

全テストがPASSすることを確認してから開始。

### Step 3: リファクタリング

| 項目 | 例 |
|------|-----|
| DRY | 重複コードの共通化 |
| 定数化 | マジックナンバー除去 |
| メソッド分割 | 長いメソッドの分割 |
| ネーミング | 変数・メソッド名の改善 |

### Step 4: テスト実行→成功確認

**期待**: 全テストが**成功**すること

### Step 5: 完了→REVIEW誘導

```
================================================================================
REFACTOR完了
================================================================================
コード品質を改善しました。テストは全てPASS。
次: REVIEWフェーズ（品質検証）
================================================================================
```

## Reference

- 詳細: [reference.md](reference.md)
