# tdd-red Reference

SKILL.mdの詳細情報。必要時のみ参照。

## red-worker並列実行

### 概要

red-workerはREDフェーズで並列実行されるワーカーエージェント。Test List項目を受け取り、失敗するテストコードを作成する。

### 使用方法

```
Task tool で tdd-core:red-worker を起動:
- test_cases: 担当するテストケース
- cycle_doc: Cycle docのパス
- test_files: 作成対象のテストファイル
- language_plugin: 使用する言語プラグイン
```

### Shared Fixtures Handling

並列実行時の共有リソースの扱い:

| リソース | 対応方法 |
|----------|----------|
| conftest.py (pytest) | 並列化対象外、事前に作成 |
| TestCase基底クラス | 並列化対象外、事前に作成 |
| 共有fixture | worker起動前に作成しておく |
| データベースseed | 各workerで独立して実行 |

**原則**: 共有リソースが必要な場合、red-worker起動前にオーケストレーター（tdd-red）が作成する。

### 競合回避

- 同一テストファイルは同一workerに割り当て
- 異なるテストファイルは異なるworkerに割り当て可能
- workerは指定されたテストファイルのみ編集

## テスト設計の詳細

### Given/When/Then形式

```
Given: 前提条件（テストの初期状態）
When: アクション（テスト対象の操作）
Then: 期待結果（検証内容）
```

### テストカテゴリ

| カテゴリ | 説明 | 例 |
|---------|------|-----|
| 正常系 | 期待通りの動作 | 有効なデータでログイン成功 |
| 異常系 | エラーハンドリング | 無効なパスワードでエラー |
| 境界値 | 限界値のテスト | 最大文字数ちょうど |
| 権限 | 認可のテスト | 管理者のみアクセス可能 |

### カテゴリ別チェック項目

| カテゴリ | チェック項目 |
|----------|------------|
| **境界値** | 0、-1、MAX_INT、最小/最大長 |
| **エッジケース** | null、undefined、空文字、空配列 |
| **異常系** | 型違い、フォーマット違反、存在しないID |
| **権限** | 未認証、権限不足、他ユーザーのデータ |
| **外部依存** | API失敗、DB失敗、タイムアウト |
| **セキュリティ** | SQLi、XSS、パストラバーサル |

### テスト作成例

```php
#[Test]
public function user_can_login(): void
{
    // Given: 有効なユーザーが存在
    // When: 正しい認証情報でログイン
    // Then: ダッシュボードにリダイレクト
}
```

```python
def test_user_can_login():
    # Given: 有効なユーザーが存在
    # When: 正しい認証情報でログイン
    # Then: ダッシュボードにリダイレクト
    pass
```

## Error Handling

### テストが成功してしまう場合

```
⚠️ テストが成功しました。REDフェーズでは失敗が期待されます。

確認:
1. 実装コードが既に存在していないか
2. テストの検証が正しいか
3. モックの設定が適切か
```

### テストフレームワークエラー

```
⚠️ テストフレームワークのエラーが発生しました。

確認:
1. 依存関係がインストールされているか
2. 設定ファイルが正しいか
```
