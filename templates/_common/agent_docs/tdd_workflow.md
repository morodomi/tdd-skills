# TDD Workflow Guide

このドキュメントはTDD（Test-Driven Development）ワークフローの詳細を説明します。

---

## 7フェーズ概要

```
INIT → PLAN → RED → GREEN → REFACTOR → REVIEW → COMMIT
```

すべての機能開発・バグ修正は、この順序で進めてください。

---

## 各フェーズの詳細

### INIT - 初期化

**目的**: 要件を明確にし、Cycle docを作成する

**やること**:
- `docs/cycles/YYYYMMDD_HHMM_機能名.md` を作成
- 背景と目標を記述
- 実装コードは書かない

**完了条件**: Cycle docが作成され、目標が明確になっている

### PLAN - 計画

**目的**: テストケース一覧と実装計画を作成する

**やること**:
- テストケース一覧を作成（TODO/WIP/DISCOVERED/DONEセクション）
- アーキテクチャ設計を記述
- 実装コードは書かない

**完了条件**: テストケース一覧が完成し、実装方針が決まっている

### RED - 失敗するテスト

**目的**: テストコードを先に作成し、失敗することを確認する

**やること**:
- テストコードを作成
- テストを実行し、失敗することを確認
- 実装コードは書かない

**完了条件**: テストが正しい理由で失敗している

### GREEN - 最小実装

**目的**: テストを通すための最小限の実装を行う

**やること**:
- テストを通すための最小限のコードを実装
- ハードコードも許容（後でリファクタリング）
- テストを実行し、成功することを確認

**原則**:
- YAGNI: 必要になるまで実装しない
- 過度な抽象化をしない
- まず動くコードを書く

**完了条件**: すべてのテストが成功している

### REFACTOR - リファクタリング

**目的**: テストを維持しながらコード品質を改善する

**やること**:
- 重複排除
- 命名改善
- 構造改善
- 各変更後にテスト実行

**原則**:
- テストは常に成功し続けること
- 小さな変更を積み重ねる

**完了条件**: コード品質が改善され、テストが成功している

### REVIEW - 品質検証

**目的**: 品質基準を満たしているか確認する

**やること**:
- テストカバレッジ確認（目標90%、最低80%）
- 静的解析実行（エラー0件）
- コードフォーマット確認

**完了条件**: すべての品質基準を満たしている

### COMMIT - コミット

**目的**: 変更をGitにコミットし、ドキュメントを更新する

**やること**:
- テストリストの状態をコミットメッセージに含める
- Cycle docを更新（Progress Log）
- git commit

**完了条件**: コミットが完了し、Cycle docが更新されている

---

## バグ修正フロー

> **「エラーを見つけたら、まずテストを書く」**

### 手順

1. **INIT**: バグの再現条件を記録
2. **RED**: バグを再現するテストを作成（失敗確認）
3. **GREEN**: バグを修正（テスト成功確認）
4. **REFACTOR**: 必要に応じてリファクタリング
5. **REVIEW**: 他の機能への影響確認
6. **COMMIT**: 修正をコミット

### なぜテストが必要か？

1. **再発防止**: 同じバグが再び発生しない
2. **影響範囲の把握**: 他の機能が壊れていないか確認
3. **ドキュメント化**: バグの内容と修正方法が記録される
4. **本当に直ったか確認**: 修正が正しいことを証明

### 例外なし

以下の状況でも、必ずTDDサイクルを通す:
- 小さな修正
- 本番環境の障害
- セキュリティ脆弱性
- 緊急の顧客対応

---

## テストリスト管理（Kent Beck方式）

### 4つのセクション

```markdown
## Test List

### 実装予定（TODO）
- [ ] TC-01: ユーザー登録：正常系
- [ ] TC-02: ユーザー登録：メール重複エラー

### 実装中（WIP）
- [WIP] TC-01: ユーザー登録：正常系 ← 現在作業中

### 実装中に気づいた追加テスト（DISCOVERED）
- [ ] TC-03: パスワード強度チェック（GREEN中に気づいた - Priority: High）

### 完了（DONE）
- [x] TC-01: ユーザー登録：正常系
```

### DISCOVEREDの運用

実装中に新しいテストケースに気づいた場合:
1. 今すぐ対応しない
2. DISCOVEREDセクションに追加
3. Priority（High/Medium/Low）を設定
4. 今のタスクに集中
5. 次のサイクルで対応

### 優先度の目安

- **High**: 今の機能に直接影響（次サイクルで対応）
- **Medium**: 関連性が高い（近いうちに対応）
- **Low**: 将来的に必要（時間があれば対応）

---

## フェーズ遷移ルール

1. 各フェーズは順番に実行（スキップ禁止）
2. 前のフェーズが完了するまで次に進まない
3. REVIEWで品質基準を満たさない場合はREFACTORに戻る
4. **REDフェーズ（テスト作成）は絶対にスキップしない**

---

## Cycle doc テンプレート

```markdown
---
feature: [機能領域]
cycle: [サイクル識別子]
phase: INIT
created: YYYY-MM-DD HH:MM
updated: YYYY-MM-DD HH:MM
---

# [機能名]

## やりたいこと
[背景と目標]

## Scope Definition
[スコープ定義]

## Test List
### 実装予定（TODO）
### 実装中（WIP）
### 実装中に気づいた追加テスト（DISCOVERED）
### 完了（DONE）

## Progress Log
### YYYY-MM-DD - [phase]
- [作業内容]
```

---

*このドキュメントはClaudeSkills TDD Frameworkの一部です*
