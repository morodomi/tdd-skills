# [Project Name]

## Project Overview

- **Type**: [Your project type - e.g., Web Application, CLI Tool, Library]
- **Language**: [Your primary language - e.g., JavaScript, Python, PHP, Go]
- **Framework**: [Your framework - e.g., Express, Django, None]
- **Test Framework**: [Your test framework - e.g., Jest, pytest, PHPUnit, Go test]
- **Quality Tools**: [Your quality tools - e.g., ESLint, mypy, PHPStan, golangci-lint]

## TDD Workflow

このプロジェクトは厳格なTDD（Test-Driven Development）ワークフローに従います。

**重要**: すべての変更は例外なくTDDサイクルを通してください。

### 7つのフェーズ

すべての機能開発は以下の順序で進めてください：

```
INIT → PLAN → RED → GREEN → REFACTOR → REVIEW → COMMIT
```

1. **INIT（初期化）**: 要件定義とTDDドキュメント作成
2. **PLAN（計画）**: 実装計画とテストケース一覧の作成
3. **RED（失敗するテスト）**: テストコードを先に作成（失敗することを確認）
4. **GREEN（実装）**: テストを通すための最小限の実装
5. **REFACTOR（リファクタリング）**: コード品質の改善（テストは維持）
6. **REVIEW（品質検証）**: テストカバレッジと静的解析の確認
7. **COMMIT（コミット）**: 変更をGitにコミット

### フェーズの開始方法

Claude Codeで以下のコマンドを入力:
- `init` または `/tdd-init`: INITフェーズ開始
- `plan` または `/tdd-plan`: PLANフェーズ開始
- `red` または `/tdd-red`: REDフェーズ開始
- `green` または `/tdd-green`: GREENフェーズ開始
- `refactor` または `/tdd-refactor`: REFACTORフェーズ開始
- `review` または `/tdd-review`: REVIEWフェーズ開始
- `commit` または `/tdd-commit`: COMMITフェーズ開始

### フェーズ自動遷移

各フェーズ完了時に自動的に次のフェーズに遷移します（ユーザー確認なし）。

---

## バグ修正・エラー対応のTDDフロー

エラーや不具合を発見した場合も、**必ずTDDサイクルを通してください**。

### 絶対ルール

> **「エラーを見つけたら、まずテストを書く」**

- ❌ エラーを見つけた → すぐにコードを修正
- ✅ エラーを見つけた → 再現テストを作成 → 修正 → テスト成功確認

**例外はありません。緊急時・本番障害・セキュリティ脆弱性であっても、必ずテストを先に書いてください。**

### バグ修正の手順

1. **INIT**: バグの再現条件を記録（`docs/` に簡易ドキュメント作成）
2. **RED**: バグを再現するテストを作成（失敗することを確認）
3. **GREEN**: バグを修正（テストが通ることを確認）
4. **REFACTOR**: 必要に応じてリファクタリング
5. **REVIEW**: 他の機能への影響確認
6. **COMMIT**: 修正をコミット

### なぜテストが必要か？

1. **再発防止**: 同じバグが再び発生しない
2. **影響範囲の把握**: 他の機能が壊れていないか確認
3. **ドキュメント化**: バグの内容と修正方法が記録される
4. **リファクタリングの安全性**: 将来の変更時に安心
5. **本当に直ったか確認**: 修正が正しいことを証明

---

## AIアシスタントへの厳格な指示

AIアシスタント（Claude、GitHub Copilot等）は、以下のルールを**絶対に**守ってください：

### 1. エラー発見時の対応

ユーザーがエラーや不具合を報告した場合：

❌ **禁止**:
```
修正しました。[修正内容]
```

✅ **必須**:
```
エラーを確認しました。TDDサイクルで対応しましょう。

まず、このエラーを再現するテストを作成します。
テストが失敗することを確認してから、修正を実装します。

1. RED: 再現テストを作成しますか？
```

### 2. コード修正依頼時の対応

ユーザーが「〜を修正して」と依頼した場合：

❌ **禁止**:
```
以下のように修正しました：
[修正コード]
```

✅ **必須**:
```
修正する前に、テストを作成しましょう。

現在の問題を再現するテストケースを作成します。
その後、テストを通すように修正を実装します。

TDDサイクルで進めますか？
```

### 3. 「急いでいる」と言われた場合

ユーザーが「急いでいるから直接修正して」と言った場合：

❌ **禁止**:
```
わかりました。直接修正します。
```

✅ **必須**:
```
急いでいる場合でも、テストを先に書くことで：
- 修正が正しいことを確認できます
- 他の機能を壊していないことを確認できます
- 同じバグの再発を防げます

テストの作成は数分で完了します。
TDDサイクルで進めましょう。

まず再現テストを作成します。
```

### 4. 例外は認めない

以下の状況でも、**必ずTDDサイクルを通してください**：

- 「小さな修正だから」 → ✗ 例外ではない
- 「本番環境で障害発生」 → ✗ テストを先に書く
- 「セキュリティ脆弱性」 → ✗ テストを先に書く
- 「顧客が待っている」 → ✗ テストを先に書く

**すべての変更は、テストファーストで進めてください。**

---

## TDDドキュメント管理

### ドキュメント配置

すべての機能開発・バグ修正は `docs/` ディレクトリにTDDドキュメントを作成してください。

**命名規則**: `docs/YYYYMMDD_hhmm_機能名.md`

**例**:
- `docs/20251105_1430_ユーザー登録機能.md`
- `docs/20251105_1600_バグ修正_ログインエラー.md`

### ドキュメント構成

```markdown
# 機能名: [機能名]

## INIT: 要件定義

### 背景
[なぜこの機能が必要か / バグの発生状況]

### 目標
[何を実現するか / バグをどう修正するか]

## PLAN: 実装計画

### テストケース一覧

#### 実装予定（TODO）
- [ ] TC-01: [テストケース]
- [ ] TC-02: [テストケース]

#### 実装中（WIP）
（現在作業中のテストケース）

#### 実装中に気づいた追加テスト（DISCOVERED）
（実装中に発見した新しいテストケース）

#### 完了（DONE）
- [x] TC-XX: [完了したテストケース]

### アーキテクチャ設計
[実装の設計方針]

## RED: テストコード

[失敗するテストコードの作成]

## GREEN: 実装

[テストを通すための実装]

## REFACTOR: リファクタリング

[コード品質の改善]

## REVIEW: 品質検証

### テスト結果
- カバレッジ: XX%
- 静的解析: エラー0件

### チェックリスト
- [ ] すべてのテストが成功
- [ ] カバレッジ目標達成
- [ ] 静的解析エラー0件
- [ ] コーディング規約準拠

## COMMIT: コミット情報

コミットハッシュ: [hash]
```

---

## テストリストの管理

### 重要な原則

実装中に新しいテストケースや問題に気づいた場合：

1. **今すぐ対応しない**
2. **テストリストに追加する**
3. **今のタスクに集中する**
4. **次のサイクルで対応する**

### 追加方法

TDDドキュメントの「実装中に気づいた追加テスト（DISCOVERED）」セクションに追記：

```markdown
### 実装中に気づいた追加テスト（DISCOVERED）
- [ ] TC-XX: [新しいテストケース]（[フェーズ]中に気づいた - Priority: [High/Medium/Low]）
```

**例**:
```markdown
- [ ] TC-04: パスワードリセット機能（GREEN中に気づいた - Priority: High）
- [ ] TC-05: セッション有効期限（REFACTOR中に気づいた - Priority: Medium）
```

### 優先度の判断

- **Priority: High**: 今実装中の機能に直接影響（次のサイクルで対応）
- **Priority: Medium**: 関連性が高い（近いうちに対応）
- **Priority: Low**: 将来的に必要（時間があれば対応）

---

## 各フェーズでの注意点

### INIT フェーズ
- TDDドキュメントを作成
- 要件を明確化
- 実装コードは書かない

### PLAN フェーズ
- テストケース一覧を作成
- アーキテクチャ設計を記述
- 実装コードは書かない

### RED フェーズ
- テストコードを先に作成
- テストが失敗することを確認
- 実装コードは書かない

### GREEN フェーズ
- テストを通すための最小限の実装
- YAGNI原則（必要になるまで実装しない）
- ハードコードも許容

### REFACTOR フェーズ
- コード品質を改善
- テストは維持（すべて成功し続けること）
- 重複排除、命名改善、構造改善

### REVIEW フェーズ
- テストカバレッジ確認
- 静的解析実行
- コーディング規約チェック
- すべての品質基準を満たす

### COMMIT フェーズ
- テストリストの状態を記録
- わかりやすいコミットメッセージ
- 次のサイクルへの引き継ぎ

---

## フェーズ遷移のルール

- 各フェーズは順番に実行する（スキップ禁止）
- 前のフェーズが完了するまで次に進まない
- REVIEW フェーズで品質基準を満たさない場合は REFACTOR に戻る
- **どんな理由があっても、REDフェーズ（テスト作成）をスキップしてはいけない**

---

## Quality Standards

このプロジェクトは以下の品質基準を遵守します。

### テストカバレッジ

- **目標**: 90%以上
- **最低ライン**: 80%
- **測定**: [Your coverage command - e.g., `npm test -- --coverage`, `pytest --cov`, `composer test -- --coverage`]

### 静的解析

- **ツール**: [Your static analysis tool - e.g., ESLint, mypy, PHPStan, golangci-lint]
- **レベル**: [Your strictness level - e.g., strictest, Level 8, max]
- **エラー許容**: 0件
- **実行**: [Your analysis command - e.g., `npm run lint`, `mypy .`, `vendor/bin/phpstan analyse`]

### コーディング規約

- **ツール**: [Your formatter - e.g., Prettier, black, Laravel Pint, gofmt]
- **実行**: [Your format command - e.g., `npm run format`, `black .`, `composer pint`]
- **規約**: [Your style guide - e.g., Airbnb, PEP 8, PSR-12]

### テスト形式

- **テスト構造**: [Your test structure - e.g., describe/it, class-based, #[Test] attribute]
- **意図の明確化**: Given/When/Then/And コメントで意図を明確化
- **テスト分離**: Unit/Integration テストを適切に分離

---

## Customization

このテンプレートは**最小コアテンプレート**です。以下をプロジェクト固有にカスタマイズしてください：

### 1. プロジェクト固有の検証ルール（tdd-init）

`.claude/skills/tdd-init/SKILL.md` を編集:

```markdown
# 追加の検証項目例

## プロジェクト構造の検証
- package.json/composer.json/requirements.txt が存在するか
- 必要なディレクトリ（src/, tests/, config/）が存在するか
- 環境変数ファイル（.env.example）が存在するか

## 依存関係の検証
- 必要なパッケージがインストールされているか
- 開発ツール（linter, formatter, test framework）が設定されているか
```

### 2. テストフレームワーク固有のルール（tdd-red）

`.claude/skills/tdd-red/SKILL.md` を編集:

```markdown
# 言語/フレームワーク固有のテストルール

## Node.js + Jest
- テストファイル名: `*.test.js` または `*.spec.js`
- テスト構造: `describe` と `test`/`it`
- モック: `jest.mock()` を使用

## Python + pytest
- テストファイル名: `test_*.py` または `*_test.py`
- テスト構造: `test_` で始まる関数
- フィクスチャ: `@pytest.fixture` を使用

## PHP + PHPUnit
- テストファイル名: `*Test.php`
- テスト構造: `#[Test]` 属性または `test` プレフィックス
- データプロバイダ: `#[DataProvider]` を使用
```

### 3. 品質ツールの設定（tdd-review）

`.claude/skills/tdd-review/SKILL.md` を編集:

```markdown
# プロジェクト固有の品質チェック

## 実行コマンド
- 静的解析: [your command]
- コーディング規約: [your command]
- カバレッジ: [your command]

## 品質基準
- 静的解析: エラー0件
- カバレッジ: 90%以上
- コーディング規約: 違反0件
```

---

## Examples

このテンプレートのカスタマイズ例は、ClaudeSkillsリポジトリで確認できます：

### Laravel用テンプレート
- **パス**: `ClaudeSkills/templates/laravel/`
- **カスタマイズ内容**: Laravel固有のテストルール、PHPStan Level 8、Laravel Pint
- **ドキュメント**: `docs/LARAVEL_INSTALLATION.md`

### Bedrock/WordPress用テンプレート
- **パス**: `ClaudeSkills/templates/bedrock/`
- **カスタマイズ内容**: WordPress固有のセキュリティルール、wp-phpunit、Brain Monkey
- **ドキュメント**: `docs/BEDROCK_INSTALLATION.md`

### カスタマイズの参考に
1. 既存テンプレートの構造を確認
2. プロジェクト固有のルールを追加
3. 不要なルールを削除

---

## Available Commands

### テスト実行

```bash
# すべてのテスト
[your test command - e.g., npm test, pytest, composer test]

# Unitテストのみ
[your unit test command]

# Integrationテストのみ
[your integration test command]

# カバレッジ付き
[your coverage command]
```

### 静的解析

```bash
# 静的解析実行
[your analysis command - e.g., npm run lint, mypy ., composer stan]
```

### コーディング規約

```bash
# チェックのみ
[your format check command - e.g., npm run format:check, black --check ., composer pint]

# 自動修正
[your format fix command - e.g., npm run format, black ., composer pint:fix]
```

### すべてのチェック

```bash
# すべての品質チェック
[your check command - e.g., npm run check, make check, composer check]
```

---

## Testing Guidelines

### テストディレクトリ構造

```
tests/
├── unit/              # 純粋なロジック（外部依存なし）
│   └── *.[test|spec]  # 高速なユニットテスト
├── integration/       # 外部依存を含む統合テスト
│   └── *.[test|spec]  # データベース、API等
└── e2e/               # エンドツーエンドテスト（オプション）
    └── *.[test|spec]  # ブラウザ、UI等
```

### テストの選択

#### ユニットテスト
- 純粋なロジック（外部依存なし）
- 高速な実行
- モック/スタブを使用

#### 統合テスト
- 外部システムとの統合
- データベース、API、ファイルシステム等
- 実環境に近い検証

#### エンドツーエンドテスト（オプション）
- ユーザー視点の検証
- ブラウザ、CLI、UI等
- 最も遅い実行

---

## Commit Guidelines

### コミットメッセージ形式

```
feat: 新機能を追加
fix: バグ修正
docs: ドキュメント更新
refactor: リファクタリング
test: テスト追加・修正
chore: ビルド、補助ツール等の変更
```

### 例

```bash
git commit -m "feat: ユーザー認証機能を実装"
git commit -m "fix: パスワードバリデーションのバグを修正"
git commit -m "test: ログイン機能のテストケース追加"
```

---

## Development Workflow Example

```
1. Claude Codeで「init」と入力
   → TDDドキュメント（docs/tdd/YYYYMMDD_hhmm_機能名.md）が作成される

2. PLANフェーズで実装計画とテストケースを定義
   → 自動的にREDフェーズへ遷移

3. REDフェーズでテスト作成
   → tests/unit/feature.test.js
   → tests/integration/feature.test.js
   → 自動的にGREENフェーズへ遷移

4. GREENフェーズで最小限の実装
   → src/feature.js
   → 自動的にREFACTORフェーズへ遷移

5. REFACTORフェーズでリファクタリング
   → コードを改善
   → 自動的にREVIEWフェーズへ遷移

6. REVIEWフェーズで品質チェック
   → 静的解析: 0 errors
   → カバレッジ: 95%
   → コーディング規約: OK
   → 自動的にCOMMITフェーズへ遷移

7. COMMITフェーズでコミット
   → git add .
   → git commit -m "feat: 新機能実装"
```

---

## Notes for Claude Code

### メタルール

- コードの動作、ファイル場所、システム状態について不確実な場合は**推測せず、ユーザーに明確化を求める**
- 「おそらく〜」「〜だと思います」などの曖昧な表現を避ける
- 絶対に必要でない限り、新規ファイルを作成しない
- **既存ファイルの編集を新規作成より優先する**

### ユーザーへの選択肢提示ルール

ユーザーに選択を求める際は、**必ず以下の形式**で提示してください：

#### 必須要素

1. **推奨度**: ★（星）5段階で表現（★☆☆☆☆ ～ ★★★★★）
2. **理由**: 各選択肢を推奨する/しない理由を明記

#### 提示形式

```
選択肢:
1. [推奨★★★★★] [選択肢の内容]
   理由: [この選択肢を強く推奨する理由]

2. [推奨★★★★☆] [選択肢の内容]
   理由: [この選択肢の理由・メリット]

3. [推奨★★★☆☆] [選択肢の内容]
   理由: [中立的・状況次第の理由]

4. [推奨★★☆☆☆] [選択肢の内容]
   理由: [あまり推奨しない理由・デメリット]

どうしますか？
```

#### 推奨度の目安

- **★★★★★ (強く推奨)**:
  - 95%以上のケースで最適
  - 最も一般的で適切な選択肢
  - リスクが低く、効率的
  - 初心者でも安全

- **★★★★☆ (推奨)**:
  - 70-94%のケースで最適
  - 一般的に良い選択肢
  - 条件が揃えば最適
  - 実績がある

- **★★★☆☆ (中立・状況次第)**:
  - 50-69%のケースで有効
  - メリットとデメリットが半々
  - 特定の条件下で有効
  - 状況によっては最適

- **★★☆☆☆ (あまり推奨しない)**:
  - 30-49%のケースで有効
  - デメリットが多い
  - リスクや手間が大きい
  - 限定的な状況でのみ有効

- **★☆☆☆☆ (非推奨)**:
  - 30%未満のケースでのみ有効
  - 特殊なケースのみ
  - 他の選択肢が使えない場合のみ
  - 避けるべき

#### 例1: Overviewドキュメントが存在しない場合

```
選択肢:
1. [推奨★★★★★] このまま進める（CLAUDE.md/README.mdで十分な情報がある）
   理由: 小規模プロジェクトでは過剰な構造化は不要。95%のケースでこれが最適

2. [推奨★★★★☆] PLANフェーズで必要なら作成する
   理由: 実際に必要性を感じてから作成する方が効率的。柔軟な対応

3. [推奨★★☆☆☆] 今すぐOverview docを作成する（時間がかかる）
   理由: 時間がかかる。大規模化が確実な場合のみ有効

どうしますか？
```

#### 例2: 既存のTDDサイクルが進行中の場合

```
選択肢:
1. [推奨★★★★★] 既存のTDDサイクルを継続する（INITは不要）
   理由: 複数サイクルを並行すると混乱しやすい。完了してから新規開始が安全

2. [推奨★★☆☆☆] 新しいサイクルを開始する（既存サイクルと並行開発）
   理由: 独立した機能で影響がない場合のみ有効。管理コストが増加

どうしますか？
```

#### 例3: テストフレームワーク選択（4個の選択肢）

```
選択肢:
1. [推奨★★★★★] PHPUnit + Pest
   理由: モダンな記法とPHPUnitの安定性の両立。Laravelプロジェクトで最適

2. [推奨★★★★☆] PHPUnit のみ
   理由: 実績豊富で安定。チームが慣れている場合に推奨

3. [推奨★★★☆☆] Pest のみ
   理由: モダンで読みやすいが、PHPUnitの機能が必要な場合は不足

4. [推奨★★☆☆☆] Codeception
   理由: E2Eテスト向け。単体・統合テストには過剰な機能

どうしますか？
```

#### 禁止事項

❌ **推奨度や理由なしの選択肢提示**:
```
選択肢:
1. このまま進める
2. Overview docを作成する
3. PLANフェーズで作成する
```

✅ **正しい提示方法**（上記の例参照）

### 開発での重要原則

1. **テストファースト**: 実装前にテストを書く
2. **最小限の実装**: テストを通すための最小限の実装
3. **リファクタリング**: テストが通った後にコードを改善
4. **品質基準の遵守**: 静的解析、カバレッジ、コーディング規約
5. **意図の明確化**: Given/When/Then/And コメントで意図を明確化

### プロジェクト固有の注意事項

[Add your project-specific notes here]

例:
- セキュリティ対策: 入力のサニタイズ、出力のエスケープ
- パフォーマンス: N+1問題の回避、キャッシュの活用
- 国際化: すべての文字列を翻訳可能に
- アクセシビリティ: WAI-ARIA準拠

---

## Language/Framework Specific Examples

### Node.js + Jest

```javascript
// tests/unit/math.test.js
describe('Math operations', () => {
  test('adds two numbers', () => {
    // Given: 2つの数値
    const a = 1;
    const b = 2;

    // When: 足し算を実行
    const result = add(a, b);

    // Then: 正しい結果を返す
    expect(result).toBe(3);
  });
});
```

### Python + pytest

```python
# tests/unit/test_math.py
def test_add_two_numbers():
    # Given: 2つの数値
    a = 1
    b = 2

    # When: 足し算を実行
    result = add(a, b)

    # Then: 正しい結果を返す
    assert result == 3
```

### PHP + PHPUnit

```php
// tests/Unit/MathTest.php
use PHPUnit\Framework\TestCase;
use PHPUnit\Framework\Attributes\Test;

class MathTest extends TestCase
{
    #[Test]
    public function adds_two_numbers(): void
    {
        // Given: 2つの数値
        $a = 1;
        $b = 2;

        // When: 足し算を実行
        $result = add($a, $b);

        // Then: 正しい結果を返す
        $this->assertSame(3, $result);
    }
}
```

---

*最終更新: [YYYY-MM-DD]*
*ClaudeSkills Version: [バージョン]*
