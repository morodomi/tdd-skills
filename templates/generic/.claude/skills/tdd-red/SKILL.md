---
name: tdd-red
description: REDフェーズ用。テストコードのみを作成し、実装コードは一切書かない。ユーザーが「red」「テスト」「テスト作成」と言った時、PLANフェーズ完了後、または /tdd-red コマンド実行時に使用。最新のTDDドキュメント（docs/YYYYMMDD_hhmm_*.md）のテストケース一覧を基にテストを作成。
allowed-tools: Read, Write, Grep, Glob, Bash
---

# TDD RED Phase

あなたは現在 **REDフェーズ** にいます。

## このフェーズの目的

失敗するテストコードを作成し、実装の要件を明確にすることです。
最新のTDDドキュメントのテストケース一覧を基に、テストを作成します。

## このフェーズでやること

- [ ] 最新のTDDドキュメントを検索する（`ls -t docs/202*.md | head -1`）
- [ ] TDDドキュメントを読み込む
- [ ] テストケース一覧セクションを抽出する
- [ ] 既存のテストディレクトリ構造を確認する
- [ ] テストを作成する
- [ ] すべてのテストが失敗することを確認するよう促す
- [ ] 次のフェーズ（GREEN）を案内する

## このフェーズで絶対にやってはいけないこと

- 実装コードを書くこと（プロダクションコードの作成禁止）
- テストを通すためのコードを書くこと
- ユーザーの承認なしに実装を始めること
- テストを通す（成功させる）こと

## ワークフロー

### 1. 準備フェーズ

まず、以下を確認してください：

```bash
# 最新のTDDドキュメントを検索
ls -t docs/202*.md 2>/dev/null | head -1

# TDDドキュメントの読み込み
Read docs/YYYYMMDD_hhmm_<機能名>.md

# テストディレクトリ構造の確認
Glob tests/**/*.[your test file extension]
```

**ドキュメントが見つからない場合**:

```
エラー: TDDドキュメントが見つかりません。

まず tdd-init と tdd-plan を実行してください。

手順:
1. /tdd-init を実行
2. /tdd-plan を実行してPLANセクションを完成させる
3. 再度 /tdd-red を実行
```

TDDドキュメントから以下の情報を抽出してください：
- 「## テストケース一覧」セクション
- 各テストケースのファイル名とテストケース概要

### 2. テスト作成フェーズ

#### 2.1 作成前の確認

TDDドキュメントに記載されたテストを順番に作成します。

**作成前の確認**：
```
これから以下のテストを作成します：
- tests/XXX/XXXTest.[ext]
  - テストケース1の概要
  - テストケース2の概要

よろしいですか？
```

ユーザーの承認を得てから作成してください。

#### 2.2 テストコード構造（テストファースト原則）

REDフェーズでは、**テストファースト**の原則に従い、実装より先にテストを書きます。

テストは以下の基本構造に従ってください：

**基本テンプレート（Arrange/Act/Assert）**:

```[your language]
# Arrange（準備）
# テストに必要なデータやオブジェクトを準備

# Act（実行）
# テスト対象のコードを実行

# Assert（検証）
# 期待通りの結果が得られたか検証
```

**Given/When/Then形式のコメント推奨**:

```[your language]
def test_user_can_update_profile():
    # Given: ログイン済みユーザーがいる
    [準備処理]

    # When: プロフィールを更新する
    [実行処理]

    # Then: 成功メッセージが表示される
    [検証処理]

    # And: データが更新されている
    [追加検証処理]
```

**重要な原則**:
- テストの意図を明確にするため、Given/When/Then/Andコメントを含める
- Arrange/Act/Assert構造を意識する
- 1つのテストケースは1つの関心事をテストする

### 3. テスト実行フェーズ

すべてのテストを作成したら、テスト実行を促してください：

```
すべてのテストを作成しました。

次のステップ:
1. テストを実行してください:
   [your test command]
   例: pytest, npm test, vendor/bin/phpunit 等

2. すべてのテストが失敗することを確認してください
   （これは正常です。まだ実装がないためです）

3. 失敗メッセージを確認してください:
   - 存在しないクラスやメソッドのエラー
   - 未定義の関数のエラー
   - 等

これらのエラーが、次のGREENフェーズで実装すべき内容を示しています。
```

**重要**: この時点では、テストが失敗するのが正しい状態です。実装がないためです。

### 4. 完了フェーズ

テスト作成完了後、以下を伝えてください：

```
REDフェーズが完了しました。

作成したテストファイル:
- tests/XXX/XXXTest.[ext]
  - テストケース1
  - テストケース2

現在のTDDワークフロー:
[完了] INIT (初期化)
[完了] PLAN (計画)
[完了] RED (テスト作成) ← 現在ここ
[次] GREEN (実装)
[ ] REFACTOR (リファクタリング)
[ ] REVIEW (品質検証)
[ ] COMMIT (コミット)

次のステップ:
1. [your test command] を実行して、すべてのテストが失敗することを確認
2. GREENフェーズでは、最小限の実装でテストを通すことが目標です

================================================================================
自動遷移: 次のフェーズ（GREEN）に進みます
================================================================================

GREENフェーズ（実装）を自動的に開始します...
```

完了メッセージを表示したら、Skillツールを使って`tdd-green` Skillを起動してください。

## 制約の強制

このフェーズでは、`allowed-tools: Read, Write, Grep, Glob, Bash` のみ使用可能です。

もしユーザーが以下のような依頼をした場合は、**丁寧に拒否**してください：

- 「コントローラーを実装して」→ 「REDフェーズでは実装コードを作成できません。これはGREENフェーズで行います」
- 「テストを通して」→ 「REDフェーズではテストを失敗させたままにします。GREENフェーズで実装してテストを通します」
- 「関数を実装して」→ 「REDフェーズでは実装できません。TDDドキュメントに記載されていることを確認し、GREENフェーズで実装します」

## テストケースの優先順位

テストケースが多い場合、以下の順序で作成してください：

1. **統合テスト（E2E的なテスト）**
   - ユーザーの主要な操作フロー
   - ハッピーパス（正常系）から作成
   - エラーハンドリング（異常系）

2. **単体テスト**
   - モデル/クラスのメソッド
   - ビジネスロジック
   - ユーティリティ関数

## トラブルシューティング

### TDDドキュメントが見つからない場合

```
TDDドキュメントが見つかりません。
REDフェーズを開始する前に、INIT と PLAN フェーズを完了してください。

以下を確認してください：
- docs/YYYYMMDD_hhmm_*.md が存在するか（ls -t docs/202*.md で確認）
- TDDドキュメントに「## PLAN（実装計画）」セクションがあるか
- PLANセクション内に「## テストケース一覧」サブセクションがあるか
```

### テストケース一覧が空の場合

```
TDDドキュメントにテストケース一覧が記載されていません。

PLANフェーズに戻って、テストケースを定義してください。
```

### ユーザーが「どんなテストを書けばいいかわからない」と言った場合

```
TDDドキュメントの「## テストケース一覧」セクションに記載されたテストケースを作成します。

もしTDDドキュメントのテストケースが不明確な場合は、PLANフェーズに戻って見直しましょうか？

または、以下のような質問で具体化できます：
- この機能で、ユーザーは何ができるべきですか？
- どんな入力を受け付けますか？
- どんな出力が期待されますか？
- どんなエラーケースがありますか？
```

## プロジェクト固有のカスタマイズ

このSkillファイルはフレームワーク非依存の汎用版です。
プロジェクト固有の要件がある場合は、以下の項目をカスタマイズしてください：

1. **テストフレームワーク固有の記述**
   - インポート文（例: `import pytest`, `import unittest`）
   - テストクラス/関数の命名規則
   - アサーション記法（例: `self.assertEqual()`, `$this->assertEquals()`）

2. **テストデータの作成方法**
   - ファクトリーの使用方法（例: Laravel Factory、pytest fixtures）
   - モックの作成方法
   - テストデータベースのセットアップ

3. **テストディレクトリ構造**
   - 統合テスト/単体テストの配置場所
   - ファイル名規則（例: `XXXTest.php`, `test_XXX.py`）

4. **テスト実行コマンド**
   - フレームワーク固有のコマンド（例: `php artisan test`, `pytest`, `npm test`）

例: テストフレームワーク別のカスタマイズ

ここに言語・テストフレームワーク固有のテストコード例を追加してください：


[your test framework] では以下のように記述します：

```
// Given: [前提条件]
// When: [アクション]
// Then: [期待される結果]
```

## 参考情報

このSkillは、TDDワークフローの一部です。

- 詳細なワークフロー: README.md参照
- プロジェクト設定: CLAUDE.md参照
- 前のフェーズ: tdd-plan Skill（計画作成）
- 次のフェーズ: tdd-green Skill（実装）

### Given/When/Then/Andコメントについて

テストの意図を明確にするため、各テストケースに構造化コメントを含めてください：

- **Given**: 前提条件（テスト実行前の状態）
- **When**: アクション（何をするか）
- **Then**: 期待結果（何が起きるべきか）
- **And**: 追加の期待結果

これにより、テストの可読性が向上し、レビューしやすくなります。

---

*このSkillはClaudeSkillsプロジェクトの一部です*
