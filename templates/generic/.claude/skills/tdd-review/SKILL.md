---
name: tdd-review
description: REVIEWフェーズ用。REFACTORフェーズ完了後の最終的な品質検証を行う。すべてのテスト実行、品質基準チェック、最新TDDドキュメント（docs/YYYYMMDD_hhmm_*.md）の要件確認、レビューレポート生成を実施。ユーザーが「review」「レビュー」と言った時、REFACTORフェーズ完了後、または /tdd-review コマンド実行時に使用。
allowed-tools: Read, Grep, Glob, Bash
---

# TDD REVIEW Phase

あなたは現在 **REVIEWフェーズ** にいます。

## このフェーズの目的

REFACTORフェーズ完了後の**最終的な品質検証**を行うことです。
コミット前に、すべての要件と品質基準を満たしていることを確認します。

## このフェーズでやること

- [ ] TDDドキュメントを読み込み、要件と品質基準を確認する
- [ ] すべてのテストを実行する
- [ ] 品質チェックツールを実行する（静的解析、カバレッジ）
- [ ] TDDドキュメントの要件を満たしているか確認する
- [ ] レビューレポートを生成する
- [ ] 次のフェーズ（DOC/COMMIT）を案内する

## このフェーズで絶対にやってはいけないこと

- 実装コードを変更すること（チェックのみ）
- テストコードを変更すること
- 品質チェックをスキップすること
- 要件確認をスキップすること

## ワークフロー

### 1. 準備フェーズ

まず、TDDドキュメントを読み込んで要件と品質基準を確認してください：

```bash
# 最新のTDDドキュメントを検索
ls -t docs/202*.md 2>/dev/null | head -1

# TDDドキュメントの読み込み
Read docs/YYYYMMDD_hhmm_<機能名>.md
```

TDDドキュメントから以下の情報を抽出してください：

1. **実装範囲**
   - 対象ファイル
   - 対象外（実装すべきでないもの）

2. **受け入れ基準**
   - Given/When/Thenで定義されたシナリオ
   - 各シナリオが満たされているか

3. **品質基準**
   - テストカバレッジ目標
   - 静的解析ツールとレベル
   - その他の品質基準

これらの情報を基に、レビューを実施します。

### 2. テスト検証フェーズ

すべてのテストを実行して、テストが通っていることを確認してください：

```bash
# すべてのテストを実行
[your test command]
```

**テストが通った場合**:
```
すべてのテストが通りました。

テスト結果:
- 合格: XX件
- 失敗: 0件
- スキップ: XX件

次の品質チェックに進みます。
```

**テストが失敗した場合**:
```
テストが失敗しています。

失敗したテスト:
[テスト名とエラーメッセージ]

REVIEWフェーズを中断します。
REFACTORフェーズに戻って、テストを修正してください。

現在のTDDワークフロー:
[完了] INIT (初期化)
[完了] PLAN (計画)
[完了] RED (テスト作成)
[完了] GREEN (実装)
[戻る] REFACTOR (リファクタリング) ← ここに戻ってください
[中断] REVIEW (品質検証)
```

テストが失敗している場合は、**REVIEWフェーズをこれ以上進めません**。

### 3. 品質基準チェックフェーズ

テストが通った場合のみ、品質チェックを実施します。

#### 3.1 静的解析実行

```bash
# 静的解析実行
[your static analysis command]
```

**期待結果**:
- TDDドキュメントで指定されたレベル
- エラー: 0件

**結果の判定**:

**合格**（エラー0件）:
```
静的解析: 合格
  - レベル: [指定レベル]
  - エラー: 0件
```

**不合格**（エラーあり）:
```
静的解析: 不合格
  - レベル: [指定レベル]
  - エラー: XX件

品質基準を満たしていません。
REFACTORフェーズに戻って修正することを推奨します。

ただし、REVIEWフェーズは継続できます。
最終判定で警告として記録します。
```

#### 3.2 テストカバレッジ確認

```bash
# テストカバレッジ確認
[your coverage command]
```

**期待結果**:
- TDDドキュメントで指定されたカバレッジ（通常は90%以上）

**結果の判定**:

**合格**（目標達成）:
```
テストカバレッジ: 合格
  - カバレッジ: XX%
  - 目標: XX%以上
```

**不合格**（目標未達）:
```
テストカバレッジ: 不合格
  - カバレッジ: XX%
  - 目標: XX%以上

品質基準を満たしていません。
次のTDDサイクルでカバレッジ向上を検討してください。

REVIEWフェーズは継続できます。
最終判定で警告として記録します。
```

#### 3.3 コードフォーマット確認

```bash
# コードフォーマットチェック
[your code formatter]
```

**期待結果**:
- プロジェクトのコーディング規約に準拠
- フォーマットエラー: 0件

**結果の判定**:

**合格**（エラー0件）:
```
コードフォーマット: 合格
  - フォーマットエラー: 0件
```

**不合格**（エラーあり）:
```
コードフォーマット: 不合格
  - フォーマットエラー: XX件

コーディング規約に準拠していません。
自動修正可能な場合は修正を推奨します。

REVIEWフェーズは継続できます。
最終判定で警告として記録します。
```

### 4. 要件確認フェーズ

TDDドキュメントの要件を満たしているか確認します。

#### 4.1 実装範囲の確認

TDDドキュメントの「実装範囲」セクションと実際の実装ファイルを照合します：

```bash
# 実装ファイルの確認
Glob [your source directory]/**/*.[your extension]
```

**確認内容**:
1. TDDドキュメントの「対象ファイル」に記載されたファイルが実装されているか
2. 記載されていないファイルが追加されていないか（柔軟に判断）

**結果**:
```
実装範囲の確認:

対象ファイル:
  - [ファイル1] 実装済み
  - [ファイル2] 実装済み

その他のファイル:
  - [ファイル3] (TDDドキュメントに記載なし)
  → 実装の過程で必要になったと判断
```

#### 4.2 対象外機能の確認

TDDドキュメントの「対象外」セクションに記載された機能が実装されていないか確認します：

```
対象外機能の確認:

以下の機能は実装されていません（正しい）:
  - [対象外機能1]
  - [対象外機能2]

または

以下の対象外機能が実装されています:
  - [機能名] (ファイル: XXX)
  → TDDドキュメントの範囲外です。別のTDDサイクルで実装すべきでした。
```

#### 4.3 受け入れ基準の確認

TDDドキュメントの受け入れ基準（Given/When/Then）を満たしているか確認します：

**確認方法**:
1. TDDドキュメントの受け入れ基準セクションを読む
2. 各シナリオのGiven/When/Thenを確認
3. 対応するテストファイルを検索（Grep等で）
4. テストメソッド名やコメントから対応関係を確認
5. テストが通っているか確認（既にテスト検証フェーズで確認済み）

**対応関係の確認のヒント**:
- テストメソッド名に受け入れ基準のキーワードが含まれているか
- テストコード内のGiven/When/Thenコメントを確認
- TDDドキュメントのシナリオ番号とテストの対応を確認

```
受け入れ基準の確認:

シナリオ1: [シナリオ名]
  テスト: tests/XXX/XXXTest.[ext]::test_scenario_1
  状態: 合格

シナリオ2: [シナリオ名]
  テスト: tests/XXX/XXXTest.[ext]::test_scenario_2
  状態: 合格

すべての受け入れ基準を満たしています。
```

### 5. レビューレポート生成フェーズ

すべてのチェックが完了したら、総合的なレビューレポートを生成します。

#### レビューレポート

以下の形式でレポートを生成してください（日時は実際の現在日時を使用）：

```
================================================================================
TDD REVIEW レポート
================================================================================

プロジェクト: [機能名]
レビュー日時: [実際の現在日時 YYYY-MM-DD HH:MM形式]

--------------------------------------------------------------------------------
1. テスト検証
--------------------------------------------------------------------------------
合格
  - 合格: XX件
  - 失敗: 0件
  - スキップ: XX件

--------------------------------------------------------------------------------
2. 品質基準チェック
--------------------------------------------------------------------------------
静的解析: エラー 0件
テストカバレッジ: XX% (目標: XX%以上)

--------------------------------------------------------------------------------
3. 要件確認
--------------------------------------------------------------------------------
実装範囲: 対象ファイルすべて実装済み
対象外機能: 実装なし（正しい）
受け入れ基準: すべてのシナリオで合格

--------------------------------------------------------------------------------
4. 総合判定
--------------------------------------------------------------------------------
合格

すべての要件と品質基準を満たしています。
DOC/COMMITフェーズに進むことができます。

================================================================================
```

**総合判定の基準**:

**合格**:
- すべてのテストが通っている（必須）
- 静的解析エラー0件（完全合格の条件）
- テストカバレッジが目標以上（完全合格の条件）
- 実装範囲を満たしている（必須）

**条件付き合格**（警告あり）:
- すべてのテストが通っている（必須）
- 静的解析またはカバレッジが基準未達（警告として記録）
- 実装範囲をほぼ満たしている（必須）

```
条件付き合格（警告あり）

以下の警告があります:
- テストカバレッジ: XX% (目標: XX%以上)

改善を推奨しますが、DOC/COMMITフェーズに進むことは可能です。
```

**不合格**:
- テストが失敗している

```
不合格

テストが失敗しています。
REFACTORフェーズに戻って修正してください。
```

### 6. 完了フェーズ

レビューが合格した場合、次のステップを案内します：

```
REVIEWフェーズが完了しました。

現在のTDDワークフロー:
[完了] INIT (初期化)
[完了] PLAN (計画)
[完了] RED (テスト作成)
[完了] GREEN (実装)
[完了] REFACTOR (リファクタリング)
[完了] REVIEW (品質検証) ← 現在ここ
[次] DOC (ドキュメント更新)
[ ] COMMIT (コミット)

次のステップ:
1. DOCフェーズ: TDDドキュメントを更新してください
   - 実装の詳細を記録
   - 変更点や注意事項を追記

2. その後、COMMITフェーズに進んでください
   - git add .
   - git commit -m "feat: [機能名]を実装"
```

## 制約の強制

このフェーズでは、`allowed-tools: Read, Grep, Glob, Bash` のみ使用可能です。

**Write, Editツールは使用できません**。REVIEWフェーズは読み取り専用です。

もしユーザーが以下のような依頼をした場合は、**丁寧に拒否**してください：

- 「テストを修正して」→ 「REVIEWフェーズでは実装コードを変更できません。REFACTORフェーズに戻ってください」
- 「コードを改善して」→ 「REVIEWフェーズはチェックのみです。改善が必要な場合はREFACTORフェーズに戻ってください」
- 「TDDドキュメントを更新して」→ 「DOCフェーズで更新します。まずREVIEWを完了させましょう」

## トラブルシューティング

### TDDドキュメントが見つからない場合

```
TDDドキュメントが見つかりません。
REVIEWフェーズを開始する前に、INIT と PLAN フェーズを完了してください。

以下を確認してください：
- docs/YYYYMMDD_hhmm_*.md が存在するか（ls -t docs/202*.md で確認）
- TDDドキュメントに「## PLAN（実装計画）」セクションがあるか
```

### テストが失敗している場合

```
テストが失敗しているため、REVIEWフェーズを続行できません。

REFACTORフェーズに戻って、以下を修正してください：
1. 失敗したテストを確認
2. 実装コードを修正
3. テストが通ることを確認
4. 再度REVIEWフェーズに進む
```

### 品質基準を満たしていない場合

```
品質基準を満たしていません。

不合格項目:
- 静的解析: XX件のエラー
- カバレッジ: XX% (目標: XX%)

選択肢:
1. REFACTORフェーズに戻って改善する（推奨）
2. 警告付きでREVIEWを合格とし、次のTDDサイクルで改善する

どちらにしますか？
```

### 要件を満たしていない場合

```
TDDドキュメントの要件を満たしていない可能性があります。

確認内容:
- 対象ファイル「XXX」が実装されていません
- または、対象外機能「YYY」が実装されています

REFACTORフェーズまたはGREENフェーズに戻って修正しますか？
```

## プロジェクト固有のカスタマイズ

このSkillファイルはフレームワーク非依存の汎用版です。
プロジェクト固有の要件がある場合は、以下の項目をカスタマイズしてください：

1. **テスト実行コマンド**
   - フレームワーク固有のコマンド
   - カバレッジ取得コマンド

2. **静的解析ツール**
   - 使用するツール
   - レベル設定
   - 実行コマンド

3. **実装ファイルの検索パターン**
   - ソースディレクトリのパス
   - ファイル拡張子

4. **品質基準**
   - デフォルトのカバレッジ目標
   - デフォルトの静的解析レベル

例: Python/pytest向けカスタマイズ
```markdown
### Python品質チェック
- テスト実行: `pytest`
- カバレッジ: `pytest --cov=. --cov-report=term`
- 静的解析: `mypy .`
- ソースディレクトリ: `src/**/*.py`, `app/**/*.py`
```

例: 言語・フレームワーク固有のカスタマイズ

ここに言語固有の品質検証コマンドを追加してください：

```markdown
### 品質チェック
- テスト実行: [your test runner]
- カバレッジ: [your coverage tool]
- 静的解析: [your static analysis tool]
- ソースディレクトリ: [your source paths]
```

## 参考情報

このSkillは、TDDワークフローの一部です。

- 詳細なワークフロー: README.md参照
- プロジェクト設定: CLAUDE.md参照
- 前のフェーズ: tdd-refactor Skill（リファクタリング）
- 次のフェーズ: DOC/COMMIT（ドキュメント更新・コミット）

### REVIEWフェーズの重要性

REVIEWフェーズは、TDDサイクルの最終ゲートです：

- **品質保証**: すべての品質基準を満たしているか確認
- **要件確認**: TDDドキュメントの要件を満たしているか確認
- **コミット前チェック**: 問題を早期発見

「コミットする前に確認する」最後のチャンスです。

### レビューの観点

1. **テストの網羅性**: すべての受け入れ基準がテストされているか
2. **コードの品質**: 静的解析、カバレッジなどの基準を満たしているか
3. **要件の充足**: TDDドキュメントの実装範囲を満たしているか
4. **スコープの遵守**: 対象外の機能を実装していないか

---

*このSkillはClaudeSkillsプロジェクトの一部です*
