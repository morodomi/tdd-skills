---
name: tdd-green
description: GREENフェーズ用。REDフェーズで作成したテストを通すための最小限の実装のみを行う。ユーザーが「green」「実装」と言った時、REDフェーズ完了後、または /tdd-green コマンド実行時に使用。過剰な実装を防ぎ、テストを通すことに集中。
allowed-tools: Read, Write, Edit, Grep, Glob, Bash
---

# TDD GREEN Phase

あなたは現在 **GREENフェーズ** にいます。

## このフェーズの目的

REDフェーズで作成したテストを通すための**最小実装**（最小限の実装）を行うことです。
「動くコード」を優先し、「綺麗なコード」はREFACTORフェーズに委ねます。

## このフェーズでやること

- [ ] 最新のTDDドキュメントを検索する（`ls -t docs/202*.md | head -1`）
- [ ] 作成済みのテストファイルを確認する
- [ ] テストを実行してエラー内容を確認する
- [ ] TDDドキュメントを参照して実装範囲を確認する
- [ ] テストを通すための最小限のコードを実装する
- [ ] テストが通ることを確認する
- [ ] 次のフェーズ（REFACTOR）を案内する

## このフェーズで絶対にやってはいけないこと

- 過剰な実装を行うこと（テストにない機能の追加）
- リファクタリングを行うこと（REFACTORフェーズで行う）
- パフォーマンス最適化を行うこと（REFACTORフェーズで行う）
- 完璧なコードを書こうとすること

## ワークフロー

### 1. 準備フェーズ

まず、以下を確認してください：

```bash
# 最新のTDDドキュメントを検索
ls -t docs/202*.md 2>/dev/null | head -1

# TDDドキュメントの確認
Read docs/YYYYMMDD_hhmm_<機能名>.md

# テストファイルの確認
Glob tests/**/*.[your test extension]
```

次に、テストを実行してエラーを確認します：

```bash
# テスト実行
[your test command]
```

エラーメッセージから、何を実装すべきかを判断してください：
- クラスが存在しない → クラスを作成
- メソッドが存在しない → メソッドを追加
- 関数が存在しない → 関数を定義
- モジュールが存在しない → モジュールを作成

### 2. 実装フェーズ

#### 2.1 実装の原則

**最重要**: テストを通すための**最小限のコード**のみを書いてください。

以下の原則に従ってください：

1. **最小限**
   - テストを通すための最低限のコードのみ
   - 不要な機能は追加しない
   - テストされていない機能は実装しない

2. **単純**
   - 複雑なロジックは書かない
   - 早期リターンやハードコードも許容
   - 「動けばOK」の精神

3. **べた書き許容**
   - DRY（Don't Repeat Yourself）は気にしない
   - コピペも許容
   - 共通化はREFACTORフェーズで

4. **ハードコード許容**
   - 定数化しなくてOK
   - マジックナンバーも許容
   - 設定ファイル化はREFACTORフェーズで

#### 2.2 実装順序

以下の順序で実装してください：

1. **モデル/エンティティ**（必要な場合）
   ```[your language]
   # 最小限のクラス定義
   class User:
       def __init__(self, name):
           self.name = name
   ```

2. **ビジネスロジック**
   ```[your language]
   # 最小限のメソッド実装
   def update_profile(user, data):
       user.name = data['name']
       return user
   ```

3. **コントローラー/ハンドラー**（必要な場合）
   ```[your language]
   # 最小限のエンドポイント
   def profile_update():
       return {"status": "success"}
   ```

4. **ルーティング/URL設定**（必要な場合）
   ```[your language]
   # ルート定義
   app.route('/profile', methods=['PUT'])(profile_update)
   ```

#### 2.3 実装例

**悪い例**（過剰な実装）:
```[your language]
# GREENフェーズでこれは書かない
def create_user(data):
    # バリデーション（テストされていない）
    if not data.get('name'):
        raise ValueError('Name is required')

    # トランザクション（テストされていない）
    with transaction():
        user = User.create(data)
        send_email(user)  # 通知（テストされていない）
        log_event(user)   # ログ（テストされていない）
        return user
```

**良い例**（最小限の実装）:
```[your language]
# GREENフェーズではこれでOK
def create_user(data):
    return User.create(data)
```

テストが「バリデーションエラーを返す」をテストしている場合のみ、バリデーションを追加します。

### 3. テスト実行フェーズ

実装が完了したら、テストを実行してください：

```bash
# すべてのテストを実行
[your test command]

# 特定のテストのみ実行
[your specific test command]
```

**テストが通った場合**:
```
すべてのテストが通りました！

GREENフェーズ完了です。
次のREFACTORフェーズでコードを改善しましょう。
```

**テストが失敗した場合**:
```
テストが失敗しました。

エラーメッセージを確認してください：
[エラーメッセージ]

不足している実装を追加します。
```

エラーメッセージから、追加で必要な実装を判断して修正してください。

### 4. 完了フェーズ

すべてのテストが通ったら、以下を伝えてください：

```
GREENフェーズが完了しました。

実装したファイル:
- [実装ファイルのリスト]

現在のTDDワークフロー:
[完了] INIT (初期化)
[完了] PLAN (計画)
[完了] RED (テスト作成)
[完了] GREEN (実装) ← 現在ここ
[次] REFACTOR (リファクタリング)
[ ] REVIEW (品質検証)
[ ] COMMIT (コミット)

次のステップ:
1. テストが通ることを確認してください
2. REFACTORフェーズでは、コードの改善・DRY化・最適化を行います
3. 重要: REFACTORフェーズ中もテストは通り続けなければなりません

================================================================================
自動遷移: 次のフェーズ（REFACTOR）に進みます
================================================================================

REFACTORフェーズ（リファクタリング）を自動的に開始します...
```

完了メッセージを表示したら、Skillツールを使って`tdd-refactor` Skillを起動してください。

## 実装の原則（詳細）

### 最小限の実装とは？

- **テストを通すための最低限のコード**
  - テストが「200 OKを返す」だけなら、空のレスポンスでOK
  - テストが「特定のデータを返す」なら、そのデータをハードコードでもOK
  - テストが「データを保存する」なら、最小限の保存処理のみ

### べた書きの例

```[your language]
# GREENフェーズではこれでOK
if user.role == 'admin':
    return True
if user.role == 'editor':
    return True
if user.role == 'viewer':
    return False

# REFACTORフェーズで改善
return user.role in ['admin', 'editor']
```

### ハードコードの例

```[your language]
# GREENフェーズではこれでOK
def get_tax_rate():
    return 0.1  # 10%

# REFACTORフェーズで改善
def get_tax_rate():
    return config.get('tax.rate')
```

## 制約の強制

このフェーズでは、`allowed-tools: Read, Write, Edit, Grep, Glob, Bash` が使用可能です。

REDフェーズと異なり、**実装コードの作成が許可**されています。
また、**Bashツールが許可**されているため、テスト実行が可能です。

もしユーザーが以下のような依頼をした場合は、**丁寧に拒否**してください：

- 「ついでにXXX機能も追加して」→ 「GREENフェーズではテストを通すための最小限の実装のみです。追加機能は別のTDDサイクルで実装しましょう」
- 「このコードをリファクタリングして」→ 「GREENフェーズではリファクタリングを行いません。REFACTORフェーズで改善します」
- 「パフォーマンス最適化して」→ 「GREENフェーズでは最適化を行いません。まずテストを通すことに集中します」

## トラブルシューティング

### テストファイルが見つからない場合

```
テストファイルが見つかりません。
GREENフェーズを開始する前に、REDフェーズを完了してください。

以下を確認してください：
- テストディレクトリにテストファイルが存在するか
```

### テストがすべて通っている場合

```
すべてのテストがすでに通っています。

GREENフェーズで実装することはありません。
次のREFACTORフェーズに進みますか？
```

### 「最小限」の判断が難しい場合

```
最小限の実装の判断基準：

1. テストがチェックしていることだけを実装する
2. テストがチェックしていないことは実装しない
3. 迷ったら「ハードコードで十分か？」と自問する
4. 迷ったら「これはREFACTORフェーズで改善できるか？」と自問する

例：
- テストが「200 OKを返す」のみ → return success_response()
- テストが「特定のデータを返す」 → return {"data": "hardcoded"}
- テストが「エラーを返す」 → if invalid: raise Error()
```

## プロジェクト固有のカスタマイズ

このSkillファイルはフレームワーク非依存の汎用版です。
プロジェクト固有の要件がある場合は、以下の項目をカスタマイズしてください：

1. **実装の推奨パターン**
   - フレームワーク固有のコーディング規約
   - ディレクトリ構造の推奨
   - 命名規則

2. **テスト実行コマンド**
   - フレームワーク固有のテストコマンド
   - カバレッジ取得方法
   - 特定のテストファイルのみ実行する方法

3. **データベース/データストア操作**
   - ORM/ODMの使用方法
   - マイグレーションの実行方法
   - テストデータのセットアップ

4. **デプロイメント/ビルド**
   - 必要なビルドステップ
   - 環境変数の設定

例: フレームワーク固有のカスタマイズ

ここに言語・フレームワーク固有の実装順序を追加してください：

```markdown
### 実装順序
1. [Your database setup/migration]
2. [Your model/data layer]
3. [Your business logic/controller]
4. [Your routing/view setup]
```

## 参考情報

このSkillは、TDDワークフローの一部です。

- 詳細なワークフロー: README.md参照
- プロジェクト設定: CLAUDE.md参照
- 前のフェーズ: tdd-red Skill（テスト作成）
- 次のフェーズ: tdd-refactor Skill（リファクタリング）

### GREENフェーズの重要性

GREENフェーズは、TDDサイクルの中で最も重要なフェーズの一つです：

- **テストを通す**: 機能が動作することを証明
- **最小限**: 過剰設計を避ける（YAGNI原則）
- **速度**: 素早く動くものを作る

「完璧なコードを書く」のではなく、「動くコードを書く」ことに集中してください。
リファクタリングは次のフェーズで行います。

---

*このSkillはClaudeSkillsプロジェクトの一部です*
