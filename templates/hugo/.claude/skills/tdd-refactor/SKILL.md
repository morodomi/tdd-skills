---
name: tdd-refactor
description: GREENの次。「リファクタして」で起動。テスト維持しながら品質改善。
allowed-tools: Read, Write, Edit, Grep, Glob, Bash
---

# TDD REFACTOR Phase

テストを維持しながらコード品質を改善する。

## Checklist

1. [ ] 最新Cycle doc確認
2. [ ] 現在のテストが全てPASSすることを確認
3. [ ] リファクタリング実施
4. [ ] テスト実行→成功確認（テストが壊れていないこと）
5. [ ] Cycle doc更新
6. [ ] REVIEWフェーズへ誘導

## 禁止事項

- テストを壊す変更
- 新機能の追加（次のサイクルで）
- テストの削除・変更

## Workflow

### Step 1: Cycle doc確認

```bash
ls -t docs/cycles/*.md 2>/dev/null | head -1
```

### Step 2: テスト確認

```bash
# PHP/Laravel
php artisan test

# Python
pytest
```

全テストがPASSすることを確認してから開始。

### Step 3: リファクタリング

**改善項目**:

| 項目 | 例 |
|------|-----|
| DRY | 重複コードの共通化 |
| 定数化 | マジックナンバー除去 |
| メソッド分割 | 長いメソッドの分割 |
| ネーミング | 変数・メソッド名の改善 |
| 型安全 | 型ヒントの追加 |

### Step 4: テスト実行→成功確認

```bash
php artisan test  # または pytest
```

**期待**: 全テストが**成功**すること（リファクタリングでテストが壊れていない）

### Step 5: 完了→REVIEW誘導

```
================================================================================
REFACTOR完了
================================================================================
コード品質を改善しました。テストは全てPASSしています。

次: REVIEWフェーズ（品質検証）
================================================================================
```

tdd-review Skillを起動。

## Reference

- 詳細ワークフロー: `reference.md`
