---
name: tdd-plan
description: PLANフェーズ用。最新のTDDドキュメント（docs/YYYYMMDD_hhmm_*.md）を検索し、PLANセクションを追記する。実装計画のみ作成し、実装コードは一切書かない。ユーザーが「plan」「計画」「設計」と言った時、または /tdd-plan コマンド実行時に使用。ユーザーと対話しながらPLANセクションを作成。WordPress/Bedrockプロジェクト用。
allowed-tools: Read, Grep, Glob, Write, Edit, Bash
---

# TDD PLAN Phase

あなたは現在 **PLANフェーズ** にいます。

## このフェーズの目的

最新のTDDドキュメントにPLANセクションを追記し、実装の方向性を明確にすることです。
ユーザーと対話しながら、実装計画を作成します。

## このフェーズでやること

- [ ] 最新のTDDドキュメント（`docs/YYYYMMDD_hhmm_*.md`）を検索する
- [ ] ドキュメントを読み込み、INITセクションの内容を確認する
- [ ] ユーザーに実装計画について質問する
- [ ] ユーザーの回答を基にPLANセクションを作成する
- [ ] ドキュメントのPLANセクションを更新する（Editツール使用）
- [ ] ユーザーにレビューを促す

## このフェーズで絶対にやってはいけないこと

- 実装コードを書くこと（プロダクションコードの作成禁止）
- テストコードを書くこと
- ユーザーの回答を推測すること
- ユーザーの承認なしに次のフェーズに進むこと

## ワークフロー

### 1. 準備フェーズ: 最新のTDDドキュメントを検索

最新のTDDドキュメントを検索します：

```bash
# 最新のTDDドキュメントを検索（時系列順、新しい順）
ls -t docs/202*.md 2>/dev/null | head -1
```

**ドキュメントが見つかった場合**:

```bash
# ドキュメントを読み込む
Read docs/20251028_1530_XXX.md
```

INITセクションの内容を確認し、以下を把握：
- 機能名
- やりたいこと
- 開始日時

**ドキュメントが見つからない場合**:

```
エラー: TDDドキュメントが見つかりません。

まず tdd-init を実行してください。

手順:
1. /tdd-init を実行
2. やりたいことを入力
3. 機能名を確認
4. 再度 /tdd-plan を実行
```

エラーを表示して終了します。

### 2. 対話フェーズ

テンプレートの各セクションについて、**ユーザーに質問**してください。

重要な原則：
- **推測しない**: ユーザーの回答を待つ
- **明確に質問**: 何を答えて欲しいか具体的に聞く
- **1セクションずつ**: 一度に複数のセクションを聞かない

#### 質問の順序

1. **機能名**
   ```
   「実装する機能の名前を教えてください」
   ```

2. **ユーザーストーリー**
   ```
   「ユーザーストーリーを教えてください」
   - As a（ユーザー種別）: 誰が使うか
   - I want to（実現したいこと）: 何をしたいか
   - So that（目的・価値）: なぜそれが必要か
   ```

3. **受け入れ基準**
   ```
   「受け入れ基準をGiven/When/Thenで教えてください」
   - シナリオ名: どんな状況か
   - Given（前提条件）: 何が準備されているか
   - When（アクション）: 何をするか
   - Then（期待結果）: 何が起きるか
   - And（追加の期待結果）: 他に何が起きるか

   「他にシナリオはありますか？」（繰り返し）
   ```

4. **実装範囲**
   ```
   「実装する対象ファイルを教えてください」
   「この機能で実装しないもの（対象外）はありますか？」
   ```

5. **アーキテクチャ設計**
   ```
   「データモデルの設計はありますか？」（ある場合のみ詳細を聞く）
   「API設計はありますか？」（ある場合のみ詳細を聞く）
   「UI/UX設計はありますか？」（ある場合のみ詳細を聞く）
   ```

6. **テストケース一覧**
   ```
   「テストケースを教えてください」
   - テストファイルのパス（例: tests/Unit/XXXTest.php, tests/Integration/XXXTest.php）
   - テストケース概要
   - テストの種類（統合テスト、単体テスト等）
   ```

7. **見積もり**
   ```
   「見積もりを教えてください」
   - テスト作成にかかる時間
   - 実装にかかる時間
   - リファクタリングにかかる時間
   ```

8. **依存関係とリスク**
   ```
   「他の機能との依存関係はありますか？」
   「想定されるリスクはありますか？」
   ```

9. **品質基準**
   ```
   「品質基準を設定してください（デフォルトを使用する場合はEnter）」

   デフォルト:
   - テストカバレッジ: 90%以上
   - 静的解析: PHPStan Level 8（最高レベル）
   - TDD徹底

   変更する場合は、以下を教えてください：
   - テストカバレッジの目標（%）
   - PHPStanのレベル（0-8）
   - その他の品質基準
   ```

### 3. PLANセクション追記フェーズ

ユーザーの回答をすべて収集したら、既存のTDDドキュメントのPLANセクションを更新します。

**Editツールを使用して更新**:

```markdown
# 更新前（tdd-initで作成されたテンプレート）
## PLAN（実装計画）

[tdd-planで追記]

# 更新後
## PLAN（実装計画）

### ユーザーストーリー

**As a** [ユーザー種別]
**I want to** [実現したいこと]
**So that** [目的・価値]

### 受け入れ基準

#### シナリオ1: [シナリオ名]

**Given** [前提条件]
**When** [アクション]
**Then** [期待結果]
**And** [追加の期待結果]

[... 追加のシナリオ ...]

### 実装範囲

[修正対象ファイル、対象外のリスト]

### アーキテクチャ設計

[データモデル、API設計、UI/UX設計]

### テストケース一覧

[テストケースのリスト]

### 見積もり

[各フェーズの見積もり時間]

### 依存関係とリスク

[依存関係、リスク]

### 品質基準

[テストカバレッジ、PHPStanレベル、その他]
```

PLANセクションの内容構造:

```markdown
# [機能名] 実装計画

## ユーザーストーリー

**As a** [ユーザーの回答]
**I want to** [ユーザーの回答]
**So that** [ユーザーの回答]

## 受け入れ基準

### シナリオ1: [ユーザーの回答]
**Given** [ユーザーの回答]
**When** [ユーザーの回答]
**Then** [ユーザーの回答]
**And** [ユーザーの回答]

[追加シナリオ...]

## 実装範囲

### 対象ファイル
[ユーザーの回答をリスト形式で]

### 対象外
[ユーザーの回答をリスト形式で]

## アーキテクチャ設計

[ユーザーの回答に応じて、必要なセクションのみ含める]

## テストケース一覧

[ユーザーの回答をリスト形式で]

## 見積もり
- テスト作成: [ユーザーの回答]
- 実装: [ユーザーの回答]
- リファクタリング: [ユーザーの回答]

## 依存関係
[ユーザーの回答]

## リスク
[ユーザーの回答]
```

### 4. 完了フェーズ

PLANセクションを追記したら、以下を伝えてください：

```
TDDドキュメントのPLANセクションを更新しました: docs/YYYYMMDD_hhmm_<機能名>.md

次のステップ:
1. PLANセクションの内容をレビューしてください
2. 修正が必要な場合は、直接ファイルを編集するか、私に修正を依頼してください
3. レビューが完了したら教えてください

現在のTDDワークフロー:
[完了] INIT (初期化)
[完了] PLAN (計画) ← 現在ここ
[次] RED (テスト作成)
[ ] GREEN (実装)
[ ] REFACTOR (リファクタリング)
[ ] REVIEW (品質検証)
[ ] DOC (ドキュメント更新)
[ ] COMMIT (コミット)
```

ユーザーがレビュー完了を伝えたら、以下のメッセージを表示してください：

```
================================================================================
自動遷移: 次のフェーズ（RED）に進みます
================================================================================

REDフェーズ（テスト作成）を自動的に開始します...
```

その後、Skillツールを使って`tdd-red` Skillを起動してください。

## 制約の強制

このフェーズでは、`allowed-tools: Read, Grep, Glob, Write, Edit, Bash` のみ使用可能です。

もしユーザーが以下のような依頼をした場合は、**丁寧に拒否**してください：

- 「プラグインファイルを作成して」→ 「PLANフェーズでは実装コードを作成できません。まずPLANセクションを完成させましょう」
- 「テストを書いて」→ 「PLANフェーズではテストを作成できません。これはREDフェーズで行います」
- 「ファイルを作成して」→ 「PLANフェーズではファイル作成はできません。TDDドキュメントに記載しておきましょう」

## トラブルシューティング

### ユーザーが「わからない」と回答した場合

```
理解しました。このセクションは後で埋めることもできます。
スキップしますか？それとも、例を示しましょうか？
```

### ユーザーが曖昧な回答をした場合

```
もう少し具体的に教えていただけますか？
例えば、[具体例]のような形で答えていただけると助かります。
```

## プロジェクト固有のカスタマイズ

このSkillファイルはWordPress/Bedrock環境用です。

### WordPress/Bedrock固有の質問項目

**アーキテクチャ設計**セクションでは、以下も確認してください：

- **カスタム投稿タイプ**: 使用する場合
- **カスタムタクソノミー**: 使用する場合
- **ショートコード**: 定義する場合
- **Hooks/Filters**: 使用する既存フック、新規作成フック
- **Widget/Block**: 実装する場合

**品質基準**:

デフォルト品質基準（WordPress/Bedrock）:
- テストカバレッジ: 90%以上
- PHPStan: Level 8（最高レベル）
- WordPress Coding Standards準拠
- セキュリティ対策（サニタイズ/エスケープ/Nonce検証）必須
- TDD徹底

## 参考情報

このSkillは、WordPress/Bedrock開発におけるTDDワークフローの一部です。

- 詳細なワークフロー: README.md参照
- プロジェクト設定: CLAUDE.md参照
- 次のフェーズ: tdd-red Skill（テスト作成）

---

*このSkillはClaudeSkillsプロジェクトの一部です*
