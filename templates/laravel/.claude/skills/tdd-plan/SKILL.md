---
name: tdd-plan
description: PLANフェーズ用。実装計画ドキュメントのみを作成し、実装コードは一切書かない。ユーザーが「plan」「計画」「設計」と言った時、または /tdd-plan コマンド実行時に使用。テンプレートを埋めるようにユーザーに質問する。Laravel開発のTDDワークフローで使用。
allowed-tools: Read, Grep, Glob, Write
---

# TDD PLAN Phase

あなたは現在 **PLANフェーズ** にいます。

## このフェーズの目的

実装計画ドキュメント（PLAN.md）を作成し、実装の方向性を明確にすることです。
ユーザーと対話しながら、テンプレートの各セクションを埋めていきます。

## このフェーズでやること

- [ ] PLAN.md.templateを読み込む
- [ ] テンプレートの各セクションについてユーザーに質問する
- [ ] ユーザーの回答を記録する
- [ ] 回答を基にPLAN.mdを生成する（`docs/tdd/PLAN.md`）
- [ ] ユーザーにレビューを促す

## このフェーズで絶対にやってはいけないこと

- 実装コードを書くこと（`app/`, `tests/`, `database/` 等への書き込み禁止）
- テストコードを書くこと
- データベースマイグレーションを作成すること
- ユーザーの回答を推測すること
- ユーザーの承認なしに次のフェーズに進むこと

## ワークフロー

### 1. 準備フェーズ

まず、以下を確認してください：

```bash
# PLAN.md.templateの読み込み
Read .claude/skills/tdd-plan/templates/PLAN.md.template

# INIT.mdが存在すれば読み込む（オプション）
Read docs/tdd/INIT.md  # 存在する場合のみ
```

### 2. 対話フェーズ

テンプレートの各セクションについて、**ユーザーに質問**してください。

重要な原則：
- **推測しない**: ユーザーの回答を待つ
- **明確に質問**: 何を答えて欲しいか具体的に聞く
- **1セクションずつ**: 一度に複数のセクションを聞かない

#### 質問の順序

1. **機能名**
   ```
   「実装する機能の名前を教えてください」
   ```

2. **ユーザーストーリー**
   ```
   「ユーザーストーリーを教えてください」
   - As a（ユーザー種別）: 誰が使うか
   - I want to（実現したいこと）: 何をしたいか
   - So that（目的・価値）: なぜそれが必要か
   ```

3. **受け入れ基準**
   ```
   「受け入れ基準をGiven/When/Thenで教えてください」
   - シナリオ名: どんな状況か
   - Given（前提条件）: 何が準備されているか
   - When（アクション）: 何をするか
   - Then（期待結果）: 何が起きるか
   - And（追加の期待結果）: 他に何が起きるか

   「他にシナリオはありますか？」（繰り返し）
   ```

4. **実装範囲**
   ```
   「実装する対象ファイルを教えてください」
   「この機能で実装しないもの（対象外）はありますか？」
   ```

5. **アーキテクチャ設計**
   ```
   「データモデルの設計はありますか？」（ある場合のみ詳細を聞く）
   「API設計はありますか？」（ある場合のみ詳細を聞く）
   「UI/UX設計はありますか？」（ある場合のみ詳細を聞く）
   ```

6. **テストケース一覧**
   ```
   「Feature Testsのテストケースを教えてください」
   - ファイル名: tests/Feature/XXXTest.php
   - テストケース概要

   「Unit Testsのテストケースを教えてください」
   - ファイル名: tests/Unit/XXXTest.php
   - テストケース概要
   ```

7. **見積もり**
   ```
   「見積もりを教えてください」
   - テスト作成にかかる時間
   - 実装にかかる時間
   - リファクタリングにかかる時間
   ```

8. **依存関係とリスク**
   ```
   「他の機能との依存関係はありますか？」
   「想定されるリスクはありますか？」
   ```

9. **品質基準**
   ```
   「品質基準を設定してください（デフォルトを使用する場合はEnter）」

   デフォルト:
   - テストカバレッジ: 90%以上
   - PHPStan: Level 8（最高レベル）
   - TDD徹底

   変更する場合は、以下を教えてください：
   - テストカバレッジの目標（%）
   - PHPStanのレベル（0-8）
   - その他の品質基準
   ```

### 3. 生成フェーズ

ユーザーの回答をすべて収集したら、PLAN.mdを生成します。

```bash
# ディレクトリ作成（存在しなければ）
mkdir -p docs/tdd/

# PLAN.md生成
Write docs/tdd/PLAN.md
```

生成するPLAN.mdの構造:

```markdown
# [機能名] 実装計画

## ユーザーストーリー

**As a** [ユーザーの回答]
**I want to** [ユーザーの回答]
**So that** [ユーザーの回答]

## 受け入れ基準

### シナリオ1: [ユーザーの回答]
**Given** [ユーザーの回答]
**When** [ユーザーの回答]
**Then** [ユーザーの回答]
**And** [ユーザーの回答]

[追加シナリオ...]

## 実装範囲

### 対象ファイル
[ユーザーの回答をリスト形式で]

### 対象外
[ユーザーの回答をリスト形式で]

## アーキテクチャ設計

[ユーザーの回答に応じて、必要なセクションのみ含める]

## テストケース一覧

### Feature Tests
[ユーザーの回答をリスト形式で]

### Unit Tests
[ユーザーの回答をリスト形式で]

## 見積もり
- テスト作成: [ユーザーの回答]
- 実装: [ユーザーの回答]
- リファクタリング: [ユーザーの回答]

## 依存関係
[ユーザーの回答]

## リスク
[ユーザーの回答]
```

### 4. 完了フェーズ

PLAN.mdを生成したら、以下を伝えてください：

```
PLAN.mdを生成しました: docs/tdd/PLAN.md

次のステップ:
1. PLAN.mdの内容をレビューしてください
2. 修正が必要な場合は、直接ファイルを編集するか、私に修正を依頼してください
3. レビューが完了したら、次のフェーズ（RED - テスト作成）に進むことができます

現在のTDDワークフロー:
[完了] INIT (初期化)
[完了] PLAN (計画) ← 現在ここ
[次] RED (テスト作成)
[ ] GREEN (実装)
[ ] REFACTOR (リファクタリング)
[ ] REVIEW (品質検証)
[ ] COMMIT (コミット)
```

## 制約の強制

このフェーズでは、`allowed-tools: Read, Grep, Glob, Write` のみ使用可能です。

もしユーザーが以下のような依頼をした場合は、**丁寧に拒否**してください：

- 「Userモデルを作成して」→ 「PLANフェーズでは実装コードを作成できません。まずPLAN.mdを完成させましょう」
- 「テストを書いて」→ 「PLANフェーズではテストを作成できません。これはREDフェーズで行います」
- 「マイグレーションファイルを作成して」→ 「PLANフェーズではファイル作成はできません。PLAN.mdに記載しておきましょう」

## トラブルシューティング

### ユーザーが「わからない」と回答した場合

```
理解しました。このセクションは後で埋めることもできます。
スキップしますか？それとも、例を示しましょうか？
```

### ユーザーが曖昧な回答をした場合

```
もう少し具体的に教えていただけますか？
例えば、[具体例]のような形で答えていただけると助かります。
```

### PLAN.md.templateが見つからない場合

```
PLAN.md.templateが見つかりません。
以下を確認してください：
- .claude/skills/tdd-plan/templates/PLAN.md.template が存在するか
- パスが正しいか
```

## 参考情報

このSkillは、Laravel開発におけるTDDワークフローの一部です。

- 詳細なワークフロー: README.md参照
- プロジェクト設定: CLAUDE.md参照
- 次のフェーズ: tdd-red Skill（テスト作成）

---

*このSkillはClaudeSkillsプロジェクトの一部です*
