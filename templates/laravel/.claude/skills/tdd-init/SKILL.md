---
name: tdd-init
description: INITフェーズ用。新しい機能開発のTDDサイクルを開始する。ユーザーの「やりたいこと」から機能名を自動生成し、Overview/Feature docの確認、TDD Cycle docを作成してINITセクションを記録。PLANフェーズへ誘導。ユーザーが「init」「初期化」「新機能」と言った時、または /tdd-init コマンド実行時に使用。
allowed-tools: Read, Write, Grep, Glob, Bash
---

# TDD INIT Phase

あなたは現在 **INITフェーズ** にいます。

## このフェーズの目的

新しい機能開発の**TDDサイクルを開始**することです。
適切な準備を行い、PLANフェーズに進むための土台を作ります。

## このフェーズでやること

- [ ] TDDサイクルの開始を宣言する
- [ ] Overviewドキュメント確認（architecture.md等）
- [ ] Featureドキュメント確認または作成
- [ ] ユーザーに「やりたいこと」を質問する
- [ ] 機能名を自動生成し、ユーザーに確認する
- [ ] `docs/cycles/YYYYMMDD_hhmm_<機能名>.md`を作成する
- [ ] Scope Definition、Context & Dependencies、Test Listを含める
- [ ] PLANフェーズへの移行を案内する

## このフェーズで絶対にやってはいけないこと

- 実装計画を詳細に作成すること（PLANフェーズで行う）
- テストコードを書くこと（REDフェーズで行う）
- 実装コードを書くこと（GREENフェーズで行う）
- 過剰な分析や設計（PLANフェーズで行う）

## ワークフロー

### 1. 準備フェーズ

まず、現在の状態を確認してください：

```bash
# プロジェクトがLaravelプロジェクトか確認
ls artisan 2>/dev/null && ls composer.json 2>/dev/null
```

または、Readツールで確認：
- artisanファイルを読み込めるか
- composer.jsonに"laravel/framework"が含まれているか

Laravelプロジェクトでない場合：
```
このSkillはLaravelプロジェクト用です。
現在のディレクトリがLaravelプロジェクトか確認してください。

確認方法:
- artisanファイルが存在するか（Read artisan）
- composer.jsonに"laravel/framework"があるか（Read composer.json）

Laravelプロジェクトのルートディレクトリに移動してから再度実行してください。
```

次に、既存のTDDサイクルが進行中でないか確認：

```bash
# 最新のTDDドキュメントを検索
ls -t docs/cycles/202*.md 2>/dev/null | head -1
```

**ドキュメントが存在する場合**：

最新ファイルを読み込み、ステータスを確認します。

```
⚠️ 既存のTDDサイクルが進行中の可能性があります。

最新のドキュメント: docs/cycles/20251028_1530_XXX.md

選択肢:
1. [推奨★★★★★] 既存のTDDサイクルを継続する（INITは不要）
   理由: 複数サイクルを並行すると混乱しやすい。完了してから新規開始が安全

2. [推奨★★☆☆☆] 新しいサイクルを開始する（既存サイクルと並行開発）
   理由: 独立した機能で影響がない場合のみ有効。管理コストが増加

どうしますか？
```

ユーザーが新しいサイクルを開始することを選択した場合のみ、次に進みます。

### 2. Overviewドキュメント確認フェーズ

プロジェクト全体のOverviewドキュメントを確認します。これにより、現在のアーキテクチャと実装箇所を把握します。

#### ステップ1: Overviewドキュメントの存在確認

```bash
# Overviewドキュメントを検索
ls docs/overview/architecture.md 2>/dev/null
ls docs/overview/directories.md 2>/dev/null
```

**Overviewドキュメントが存在する場合**:

```
✓ Overviewドキュメントが見つかりました。
  - docs/overview/architecture.md
  - docs/overview/directories.md

これらを確認して、現在のアーキテクチャと実装箇所を把握します。
```

Readツールでこれらのファイルを読み込み、以下を確認：
- 現在のレイヤー構造（Controller, Service, Repository等）
- 実装マップ（既存機能とその配置場所）
- ADR（重要な設計決定）

**Overviewドキュメントが存在しない場合**:

```
⚠️ Overviewドキュメントが見つかりませんでした。

今回のTDDサイクルでは、プロジェクト全体の情報はCLAUDE.mdとREADME.mdを参照します。
将来的に、docs/overview/architecture.mdの作成を推奨します。

選択肢:
1. [推奨★★★★★] このまま進める（CLAUDE.md/README.mdで十分な情報がある）
   理由: 小規模プロジェクトでは過剰な構造化は不要。95%のケースでこれが最適

2. [推奨★★★★☆] PLANフェーズで必要なら作成する
   理由: 実際に必要性を感じてから作成する方が効率的。柔軟な対応

3. [推奨★★☆☆☆] 今すぐOverview docを作成する（時間がかかる）
   理由: 時間がかかる。大規模化が確実な場合のみ有効

どうしますか？
```

ユーザーが選択1または3を選んだ場合、次に進みます。
選択2の場合、Overview doc作成を支援してから次に進みます。

### 3. Featureドキュメント確認フェーズ

この機能に関するFeatureドキュメントの存在を確認します。

#### ステップ1: 機能領域の特定

ユーザーに質問：
```
この機能はどの領域に関連しますか？

既存の機能領域例:
- 認証（auth）
- ユーザー管理（user-management）
- データ管理（data-management）
- その他（新規機能領域）

機能領域を入力してください（例: auth）:
```

ユーザーが入力した機能領域を`feature_area`とします。

#### ステップ2: Featureドキュメントの存在確認

```bash
# Stage 1構造をチェック
ls docs/features/${feature_area}.md 2>/dev/null

# Stage 2構造をチェック
ls docs/features/${feature_area}/README.md 2>/dev/null

# Stage 3構造をチェック
ls docs/features/${feature_area}/api/README.md 2>/dev/null
```

**ケースA: Stage 1構造が存在する場合**

```
✓ Featureドキュメントが見つかりました（Stage 1: 単一ファイル）
  - docs/features/${feature_area}.md

このファイルを確認して、既存のAPI設計とDB Schemaを把握します。
```

Readツールでファイルを読み込み、以下を確認：
- 概要
- 既存のAPI設計
- DB Schema
- 実装ステータス

**ケースB: Stage 2構造が存在する場合**

```
✓ Featureドキュメントが見つかりました（Stage 2: ディレクトリ分割）
  - docs/features/${feature_area}/README.md
  - docs/features/${feature_area}/api.md
  - docs/features/${feature_area}/database.md

README.mdを確認して、実装ステータスと全体像を把握します。
```

**ケースC: Stage 3構造が存在する場合**

```
✓ Featureドキュメントが見つかりました（Stage 3: 個別ファイル分割）
  - docs/features/${feature_area}/README.md
  - docs/features/${feature_area}/api/
  - docs/features/${feature_area}/database/

README.mdを確認して、実装ステータスと全体像を把握します。
```

**ケースD: Featureドキュメントが存在しない場合**

```
⚠️ Featureドキュメントが見つかりませんでした。

この機能領域（${feature_area}）は新規のようです。

選択肢:
1. [推奨★★★★★] PLANフェーズでFeature docを作成する
   理由: 実装計画と一緒に作成する方が効率的。95%のケースでこれが最適

2. [推奨★★★★☆] Feature docなしで進める（小規模機能の場合）
   理由: Cycle docだけで十分な情報を管理できる場合。シンプルに保てる

3. [推奨★★☆☆☆] 今すぐFeature docを作成する
   理由: 全体設計を先に固めたい場合のみ。時間がかかる

どうしますか？
```

ユーザーが選択1または3を選んだ場合、次に進みます。
選択2の場合、Feature doc作成を支援してから次に進みます。

### 4. ディレクトリ準備フェーズ

docsディレクトリ構造を準備します：

```bash
# ディレクトリの存在確認
ls -d docs 2>/dev/null
ls -d docs/cycles 2>/dev/null
```

**ディレクトリが存在しない場合**:

```bash
# ディレクトリ作成
mkdir -p docs/cycles
```

成功メッセージ:
```
✓ docs/cycles ディレクトリを作成しました。
```

**ディレクトリが既に存在する場合**:
```
✓ docs/cycles ディレクトリは既に存在します。
```

### 5. 機能名決定と TDD Cycle ドキュメント作成フェーズ

#### ステップ1: やりたいことを質問

ユーザーに質問：
```
どんな機能を実装しますか？やりたいことを教えてください。

例:
- ユーザーがログインできるようにしたい
- データをCSV形式でエクスポートしたい
- 検索機能を追加したい
```

#### ステップ2: 機能名を自動生成

ユーザーの回答から適切な機能名を生成します。

**機能名生成のガイドライン**:
- 簡潔で分かりやすい名前
- 10〜20文字程度
- 「〜機能」「〜追加」「〜実装」などの接尾辞を付ける

**生成例**:
| やりたいこと | 生成される機能名 |
|------------|----------------|
| ユーザーがログインできるようにしたい | ユーザーログイン機能 |
| データをCSV形式でエクスポートしたい | CSVエクスポート機能 |
| 検索機能を追加したい | 検索機能追加 |
| パスワードリセットメールを送信する | パスワードリセットメール送信機能 |

#### ステップ3: 機能名をユーザーに確認

生成した機能名を提案：
```
機能名を「[生成した機能名]」にしますか？

そのままで良ければ「はい」と入力してください。
変更する場合は、別の機能名を入力してください。
```

ユーザーが「はい」または確認した場合、次に進みます。
ユーザーが別の名前を入力した場合、その名前を使用します。

#### ステップ4: 現在日時を取得

```bash
# YYYYMMDD_hhmm 形式で日時を取得
date +"%Y%m%d_%H%M"
```

例: `20251028_1530`

#### ステップ5: ファイル名を生成

フォーマット: `docs/cycles/YYYYMMDD_hhmm_<機能名>.md`

例:
```
docs/cycles/20251028_1530_ユーザーログイン機能.md
docs/cycles/20251028_1545_CSVエクスポート機能.md
docs/cycles/20251029_1000_検索機能追加.md
```

#### ステップ6: TDD Cycle ドキュメントを作成

Writeツールを使用してファイルを作成します。

**テンプレート内容**:
```markdown
---
feature: [機能領域（例: auth, user-management）]
cycle: [サイクル識別子（例: login-implementation）]
phase: INIT
created: YYYY-MM-DD HH:MM
updated: YYYY-MM-DD HH:MM
---

# [機能名]

## Scope Definition（スコープ定義）

### 今回実装する範囲
- [ ] [実装項目1]
- [ ] [実装項目2]
- [ ] [実装項目3]

### 今回実装しない範囲（次サイクル以降）
- ❌ [実装しない項目1]（理由: [理由]）
- ❌ [実装しない項目2]（理由: [理由]）

### 変更予定ファイル（目安: 10ファイル以下）
- [ファイルパス1]（新規/編集）
- [ファイルパス2]（新規/編集）
- [ファイルパス3]（新規/編集）

計: X ファイル

## Context & Dependencies（コンテキストと依存関係）

### 参照ドキュメント
- [docs/overview/architecture.md](../overview/architecture.md) - [参照する理由]
- [docs/features/[機能領域]/README.md](../features/[機能領域]/README.md) - [参照する理由]

### 依存する既存機能
- [既存機能1]: [ファイルパス]
- [既存機能2]: [ファイルパス]

### 関連Issue/PR
- Issue #[番号]: [タイトル]

## Test List（テストリスト）

### 実装予定（TODO）
- [ ] TC-01: [テストケース]
- [ ] TC-02: [テストケース]
- [ ] TC-03: [テストケース]

### 実装中（WIP）
（現在なし）

### 実装中に気づいた追加テスト（DISCOVERED）
（現在なし）

### 完了（DONE）
（現在なし）

## Implementation Notes（実装ノート）

### やりたいこと
[ユーザーが入力した「やりたいこと」]

### 背景
[PLANフェーズで記入]

### 設計方針
[PLANフェーズで記入]

### Anti-patterns回避
[PLANフェーズで記入]

## Progress Log（進捗ログ）

### YYYY-MM-DD HH:MM - INIT phase
- TDDサイクルドキュメント作成
- Scope定義準備完了
- Context確認完了
- Test List作成準備完了

---

## 次のステップ

1. [完了] INIT（初期化）← 現在ここ
2. [次] PLAN（計画）
3. [ ] RED（テスト作成）
4. [ ] GREEN（実装）
5. [ ] REFACTOR（リファクタリング）
6. [ ] REVIEW（品質検証）
7. [ ] DOC（ドキュメント更新）
8. [ ] COMMIT（コミット）

---

*作成日時: YYYY-MM-DD HH:MM*
*次のフェーズ: PLAN*
```

成功メッセージ:
```
✓ TDD Cycle ドキュメントを作成しました。

ファイル: docs/cycles/20251028_1530_ユーザーログイン機能.md
機能名: ユーザーログイン機能
機能領域: [feature_area]
開始日時: 2025-10-28 15:30
```

### 6. 完了フェーズ

INITフェーズが完了したことを伝え、PLANフェーズへ誘導します：

```
================================================================================
INITフェーズが完了しました
================================================================================

TDDサイクルの準備が整いました。

現在のTDDワークフロー:
[完了] INIT (初期化) ← 現在ここ
[次] PLAN (計画)
[ ] RED (テスト作成)
[ ] GREEN (実装)
[ ] REFACTOR (リファクタリング)
[ ] REVIEW (品質検証)
[ ] COMMIT (コミット)

================================================================================
次のステップ: PLANフェーズ
================================================================================

PLANフェーズでは、以下を行います：

1. **実装計画の作成**
   - 機能の詳細な仕様
   - アーキテクチャ設計
   - ファイル構成

2. **受け入れ基準の定義**
   - Given/When/Then形式
   - すべてのシナリオを網羅

3. **品質基準の確認**
   - テストカバレッジ: 90%以上
   - PHPStan: Level 8
   - その他の品質基準

4. **テストケース設計**
   - 各受け入れ基準に対応するテスト
   - エッジケースの洗い出し

================================================================================
自動遷移: 次のフェーズ（PLAN）に進みます
================================================================================

PLANフェーズを自動的に開始します...
```

完了メッセージを表示したら、Skillツールを使って`tdd-plan` Skillを起動してください。

## 制約の強制

このフェーズでは、`allowed-tools: Read, Write, Grep, Glob, Bash` が使用可能です。

**Read**: プロジェクトファイルの確認
**Write**: TDDドキュメント作成
**Grep**: ファイル検索
**Glob**: ファイルパターンマッチ
**Bash**: ディレクトリ作成、ファイル操作

もしユーザーが以下のような依頼をした場合は、**丁寧に拒否**してください：

- 「実装計画を作って」→ 「INITフェーズでは実装計画を作りません。PLANフェーズで詳細に作成します」
- 「テストを書いて」→ 「INITフェーズではテストを書きません。REDフェーズで作成します」
- 「実装して」→ 「INITフェーズでは実装しません。GREENフェーズで実装します」

## トラブルシューティング

### Laravelプロジェクトでない場合

```
エラー: このSkillはLaravelプロジェクト用です。

現在のディレクトリがLaravelプロジェクトか確認してください：
- artisanファイルが存在するか
- composer.jsonに"laravel/framework"があるか

Laravelプロジェクトのルートディレクトリに移動してから再度実行してください。
```

### 既存のTDDサイクルが進行中の場合

```
⚠️ 既存のTDDサイクルが進行中です。

以下のファイルが存在します:
- docs/cycles/20251104_1530_XXX.md

対応方法:
1. 既存のTDDサイクルを完了する（推奨）
2. 新しいサイクルを並行して開始する

どの方法を選択しますか？
```

### ディレクトリ作成に失敗した場合

```
エラー: docsディレクトリの作成に失敗しました。

考えられる原因:
- 書き込み権限がない
- ディスク容量が不足している

対応方法:
1. 権限を確認
   ```bash
   ls -la ./
   ```

2. 手動でディレクトリを作成
   ```bash
   mkdir -p docs/cycles
   ```

3. 権限を修正（必要に応じて）
   ```bash
   chmod 755 docs/
   ```
```

### 機能名が不明確な場合

```
機能名をより具体的に教えてください。

良い例:
- ユーザー認証機能
- データ検索機能
- CSV出力機能

悪い例:
- 機能
- 新しいやつ
- あれ

具体的な機能名を入力してください：
```

## 参考情報

このSkillは、Laravel開発におけるTDDワークフローの**最初のフェーズ**です。

- 詳細なワークフロー: README.md参照
- プロジェクト設定: CLAUDE.md参照
- 次のフェーズ: tdd-plan Skill（計画）

### INITフェーズの重要性

INITフェーズは、TDDサイクルの**スタート地点**です：

- **準備**: 必要なディレクトリを用意
- **宣言**: 新しい機能開発の開始を明確化
- **記録**: 開始時点の情報を記録
- **誘導**: PLANフェーズへスムーズに移行

「良いスタートが良い結果を生む」という原則に基づいています。

### INITフェーズのシンプルさ

INITフェーズは**意図的にシンプル**に設計されています：

- 詳細な分析や設計は行わない → PLANフェーズで実施
- テストは書かない → REDフェーズで実施
- 実装は行わない → GREENフェーズで実施

INITフェーズは「スタートを切る」だけです。
すぐにPLANフェーズに進んで、詳細な計画を立てましょう。

---

*このSkillはClaudeSkillsプロジェクトの一部です*
