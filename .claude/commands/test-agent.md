---
description: ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šã‚’è‡ªå‹•åŒ–ã€‚ãƒ†ã‚¹ãƒˆè¿½åŠ  + PHPStanå¯¾å¿œ + PR/Issueä½œæˆ
---

# Improve Coverage Command

TDDã‚µã‚¤ã‚¯ãƒ«å®Œäº†å¾Œã€ãƒ©ã‚¤ãƒ³ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è‡ªå‹•çš„ã«å‘ä¸Šã•ã›ã¾ã™ã€‚

## æ¦‚è¦

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¾ã™:

1. **ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š**: PHPUnitã§ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®š
2. **å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«é¸å®š**: ç›´è¿‘æ›´æ–°é »åº¦ãŒé«˜ãã€ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä½ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å„ªå…ˆ
3. **ãƒ†ã‚¹ãƒˆè¿½åŠ **: æ—¢å­˜ãƒ†ã‚¹ãƒˆæ§‹é€ ã«åˆã‚ã›ã¦ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯è§¦ã‚‰ãªã„ï¼‰
4. **PHPStanå¯¾å¿œ**: Level 8ã¾ã§æ®µéšçš„ã«å¯¾å¿œ
5. **PR/Issueä½œæˆ**: æˆåŠŸæ™‚ã¯PRã€å¤±æ•—æ™‚ã¯Issueä½œæˆ

**ç›®æ¨™**: ã‚«ãƒãƒ¬ãƒƒã‚¸ +5%ã€œ10%ï¼ˆä¸Šé™90%ï¼‰ã€PRã‚¹ã‚³ãƒ¼ãƒ— 10ãƒ•ã‚¡ã‚¤ãƒ«æœªæº€

---

## ä½¿ç”¨æ–¹æ³•

```bash
/test-agent
```

TDDã‚µã‚¤ã‚¯ãƒ«å®Œäº†å¾Œã€ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä¸‹ãŒã£ãŸã¨æ„Ÿã˜ãŸæ™‚ã«å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

---

## å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—

### Step 1: ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š

ã¾ãšã€Bashãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦PHPUnitã§ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã—ã¾ã™ã€‚

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šï¼ˆè‰²ãªã—ã€ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ï¼‰
vendor/bin/phpunit --coverage-text --colors=never > /tmp/coverage_before.txt

# çµæœã‚’è¡¨ç¤º
cat /tmp/coverage_before.txt
```

**ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆè§£æ**:

PHPUnitã®å‡ºåŠ›ã‹ã‚‰ä»¥ä¸‹ã‚’æŠ½å‡º:
- å…¨ä½“ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ï¼ˆ"Lines:" è¡Œã‹ã‚‰å–å¾—ã€ä¾‹: 72.41%ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ï¼ˆä¾‹: UserService.php = 65.22%ï¼‰

**ç›®æ¨™å€¤è¨ˆç®—**:
```
ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸ = min(ç¾åœ¨å€¤ + 10%, 90%)
```

ä¾‹: ç¾åœ¨72.41% â†’ ç›®æ¨™82.41%ï¼ˆã¾ãŸã¯90%ä¸Šé™ï¼‰

---

### Step 2: å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«é¸å®š

**é‡è¦**: ã“ã®ä½œæ¥­ã¯Taskãƒ„ãƒ¼ãƒ«ã§general-purposeã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å§”è­²ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ãƒ­ã‚¸ãƒƒã‚¯ã§å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸å®šã™ã‚‹ã‚ˆã†ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æŒ‡ç¤ºã—ã¦ãã ã•ã„:

#### 2.1 ç›´è¿‘æ›´æ–°é »åº¦ã‚’å–å¾—

```bash
# ç›´è¿‘1ãƒ¶æœˆã®æ›´æ–°é »åº¦ã‚’å–å¾—ï¼ˆPHPãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰
git log --since="1 month ago" --name-only --pretty=format: | \
  grep "\.php$" | \
  grep -v "vendor/" | \
  grep -v "tests/" | \
  sort | uniq -c | sort -rn > /tmp/update_frequency.txt

# çµæœè¡¨ç¤º
head -20 /tmp/update_frequency.txt
```

#### 2.2 ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯åˆ¤å®š

Laravelå›ºæœ‰ã®å‘½åè¦å‰‡ã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ã‚’å„ªå…ˆ:
- `app/Services/`
- `app/Http/Controllers/`
- ãã®ä»–ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

```bash
# ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ½å‡º
grep -E "app/(Services|Http/Controllers)" /tmp/update_frequency.txt > /tmp/core_logic_files.txt
```

#### 2.3 ã‚«ãƒãƒ¬ãƒƒã‚¸ã¨ã®ç…§åˆ

ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆï¼ˆ`/tmp/coverage_before.txt`ï¼‰ã¨æ›´æ–°é »åº¦ï¼ˆ`/tmp/core_logic_files.txt`ï¼‰ã‚’ç…§åˆã—ã€ä»¥ä¸‹ã®æ¡ä»¶ã§ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°:

**ã‚¹ã‚³ã‚¢è¨ˆç®—**:
```python
# ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰
for file in core_logic_files:
    coverage = get_coverage_from_report(file)
    frequency = get_update_frequency(file)

    # å„ªå…ˆé †ä½ã‚¹ã‚³ã‚¢
    if coverage < 70 and frequency >= 5:
        score = (100 - coverage) * frequency
        candidates.append((file, score, coverage, frequency))

# ã‚¹ã‚³ã‚¢é™é †ã§ã‚½ãƒ¼ãƒˆ
candidates.sort(key=lambda x: x[1], reverse=True)

# 10ãƒ•ã‚¡ã‚¤ãƒ«æœªæº€ã«åˆ¶é™ï¼ˆPRã‚¹ã‚³ãƒ¼ãƒ—ï¼‰
selected_files = candidates[:10]
```

#### 2.4 é¸å®šçµæœ

é¸å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚’ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›:

```
å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå„ªå…ˆé †ä½é †ï¼‰:
1. app/Services/UserService.php (ã‚«ãƒãƒ¬ãƒƒã‚¸: 65%, æ›´æ–°é »åº¦: 12å›, ã‚¹ã‚³ã‚¢: 420)
2. app/Http/Controllers/AuthController.php (ã‚«ãƒãƒ¬ãƒƒã‚¸: 58%, æ›´æ–°é »åº¦: 8å›, ã‚¹ã‚³ã‚¢: 336)
...
```

---

### Step 3: Task Agentèµ·å‹•

é¸å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚’ã‚‚ã¨ã«ã€**Taskãƒ„ãƒ¼ãƒ«ã§general-purposeã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•**ã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸‹ã®ä½œæ¥­ã‚’è‡ªå¾‹çš„ã«å®Ÿè¡Œã™ã‚‹ã‚ˆã†æŒ‡ç¤ºã—ã¾ã™:

#### 3.1 ãƒ–ãƒ©ãƒ³ãƒä½œæˆ

```bash
# ç¾åœ¨ã®æ—¥æ™‚ã‚’å–å¾—
TIMESTAMP=$(date +%Y%m%d-%H%M)

# ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b "test/test-agent-${TIMESTAMP}"
```

#### 3.2 å„ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ãƒ†ã‚¹ãƒˆè¿½åŠ 

é¸å®šã—ãŸå„ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œ:

**A. æ—¢å­˜ãƒ†ã‚¹ãƒˆæ§‹é€ ç¢ºèª**

```bash
# æ—¢å­˜ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
find tests -name "*UserService*Test.php"

# æ—¢å­˜ãƒ†ã‚¹ãƒˆã®è¡Œæ•°ã‚’ç¢ºèª
wc -l tests/Unit/UserServiceTest.php
```

**B. ãƒ†ã‚¹ãƒˆè¿½åŠ ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¤å®š**

- **500è¡Œæœªæº€**: æ—¢å­˜ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
- **500è¡Œä»¥ä¸Š**: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåˆ†å‰²

**ãƒ‘ã‚¿ãƒ¼ãƒ³A: æ—¢å­˜ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ **ï¼ˆ500è¡Œæœªæº€ï¼‰

æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã«åˆã‚ã›ã¦ã€æ–°ã—ã„ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ :

```php
// tests/Unit/UserServiceTest.php

#[Test]
public function ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°ãŒæˆåŠŸã™ã‚‹(): void
{
    // Given: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã™ã‚‹
    $user = User::factory()->create();

    // When: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°ã™ã‚‹
    $result = $this->service->updateProfile($user->id, ['name' => 'New Name']);

    // Then: æ›´æ–°ã•ã‚Œã‚‹
    $this->assertTrue($result);
    $this->assertEquals('New Name', $user->fresh()->name);
}
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³B: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåˆ†å‰²**ï¼ˆ500è¡Œä»¥ä¸Šï¼‰

```bash
# æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•
mkdir -p tests/Unit/UserService
mv tests/Unit/UserServiceTest.php tests/Unit/UserService/BaseTest.php

# æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
# tests/Unit/UserService/LoginTest.php
# tests/Unit/UserService/ProfileTest.php
```

**C. ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šã®ãŸã‚ã®ãƒ†ã‚¹ãƒˆè¿½åŠ **

ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã§ã€Œæœªã‚«ãƒãƒ¼ã€ã¨ãªã£ã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»åˆ†å²ã‚’ç‰¹å®šã—ã€ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ :

- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆnull, ç©ºæ–‡å­—, 0ç­‰ï¼‰
- ä¾‹å¤–å‡¦ç†
- æ¡ä»¶åˆ†å²ï¼ˆif/else, switchï¼‰
- ãƒ«ãƒ¼ãƒ—å‡¦ç†

**é‡è¦åˆ¶ç´„**:
- **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯ä¸€åˆ‡è§¦ã‚‰ãªã„**
- æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãŒå¿…è¦ãªå ´åˆã¯ã€Issueä½œæˆã—ã¦å ±å‘Š
- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ã¿è¿½åŠ ãƒ»ä¿®æ­£

#### 3.3 PHPStanå¯¾å¿œï¼ˆæ®µéšçš„ï¼‰

è¿½åŠ ã—ãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã€PHPStan Level 8ã¾ã§æ®µéšçš„ã«å¯¾å¿œ:

```bash
# Level 0ã‹ã‚‰é–‹å§‹
vendor/bin/phpstan analyse tests/Unit/UserServiceTest.php --level 0

# ã‚¨ãƒ©ãƒ¼ãŒãªã‘ã‚Œã°Level 1ã¸
vendor/bin/phpstan analyse tests/Unit/UserServiceTest.php --level 1

# ... Level 8ã¾ã§ç¹°ã‚Šè¿”ã™
vendor/bin/phpstan analyse tests/Unit/UserServiceTest.php --level 8
```

Level 8ã§ã‚¨ãƒ©ãƒ¼ãŒè§£æ±ºã§ããªã„å ´åˆ:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªã‚’æ±‚ã‚ã‚‹
- ã¾ãŸã¯ã€`@phpstan-ignore` ã§ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰

#### 3.4 ã‚«ãƒãƒ¬ãƒƒã‚¸å†æ¸¬å®š

ãƒ†ã‚¹ãƒˆè¿½åŠ å¾Œã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å†æ¸¬å®š:

```bash
vendor/bin/phpunit --coverage-text --colors=never > /tmp/coverage_after.txt

# Before/Afteræ¯”è¼ƒ
echo "=== Before ==="
grep "Lines:" /tmp/coverage_before.txt

echo "=== After ==="
grep "Lines:" /tmp/coverage_after.txt
```

---

### Step 4: æˆåŠŸåˆ¤å®šã¨PR/Issueä½œæˆ

#### 4.1 æˆåŠŸåˆ¤å®šãƒ•ãƒ­ãƒ¼

```
ã‚«ãƒãƒ¬ãƒƒã‚¸å†æ¸¬å®š
  â†“
ãƒ†ã‚¹ãƒˆå…¨é€šé?
  â”œâ”€ NO â†’ Issueä½œæˆï¼ˆãƒ†ã‚¹ãƒˆå¤±æ•—ï¼‰
  â””â”€ YES â†’ ã‚«ãƒãƒ¬ãƒƒã‚¸ä¸Šæ˜‡?
             â”œâ”€ NO â†’ Issueä½œæˆï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ä¸ŠãŒã‚‰ãšï¼‰
             â””â”€ YES â†’ +5%ä»¥ä¸Š?
                       â”œâ”€ NO â†’ Issueä½œæˆï¼ˆç›®æ¨™æœªé”ï¼‰
                       â””â”€ YES â†’ PRä½œæˆï¼ˆæˆåŠŸï¼‰
```

#### 4.2 PRä½œæˆï¼ˆæˆåŠŸæ™‚ï¼‰

ä»¥ä¸‹ã®æ¡ä»¶ã‚’ã™ã¹ã¦æº€ãŸã—ãŸå ´åˆã€`gh pr create`ã§PRã‚’ä½œæˆ:

**æ¡ä»¶**:
1. ãƒ†ã‚¹ãƒˆå…¨é€šéï¼ˆ`vendor/bin/phpunit` ãŒexit code 0ï¼‰
2. ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒ+5%ä»¥ä¸Šä¸Šæ˜‡
3. PHPStan Level 8ã‚¨ãƒ©ãƒ¼0ä»¶
4. å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒ10ãƒ•ã‚¡ã‚¤ãƒ«æœªæº€

**PRä½œæˆã‚³ãƒãƒ³ãƒ‰**:

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸å¤‰åŒ–ã‚’å–å¾—
BEFORE=$(grep "Lines:" /tmp/coverage_before.txt | grep -oE "[0-9]+\.[0-9]+%")
AFTER=$(grep "Lines:" /tmp/coverage_after.txt | grep -oE "[0-9]+\.[0-9]+%")

# å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’å–å¾—
CHANGED_FILES=$(git diff --name-only develop | wc -l)

# PRä½œæˆ
gh pr create --title "test: ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š (${BEFORE} â†’ ${AFTER})" --body "$(cat <<EOF
## æ¦‚è¦
ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’${BEFORE}ã‹ã‚‰${AFTER}ã«å‘ä¸Šã—ã¾ã—ãŸã€‚

## å¤‰æ›´å†…å®¹
- å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°: ${CHANGED_FILES}ä»¶
- è¿½åŠ ãƒ†ã‚¹ãƒˆæ•°: [AgentãŒè¨ˆç®—]

## ã‚«ãƒãƒ¬ãƒƒã‚¸è©³ç´°
| ãƒ•ã‚¡ã‚¤ãƒ« | Before | After | Diff |
|---------|--------|-------|------|
[AgentãŒå„ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰åŒ–ã‚’è¨˜å…¥]

## ãƒ†ã‚¹ãƒˆçµæœ
\`\`\`
Tests: [X] passed
Coverage: ${AFTER}
PHPStan: Level 8 (0 errors)
\`\`\`

## é™çš„è§£æ
- PHPStan: Level 8 âœ“
- Laravel Pint: OK âœ“

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)" --base develop
```

**PRä½œæˆå¾Œ**:
- PR URLã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š
- ã‚«ãƒãƒ¬ãƒƒã‚¸å¤‰åŒ–ã‚’è¦ç´„

#### 4.3 Issueä½œæˆï¼ˆå¤±æ•—æ™‚ï¼‰

ä»¥ä¸‹ã®å ´åˆã€`gh issue create`ã§Issueã‚’ä½œæˆ:

**ã‚±ãƒ¼ã‚¹1: ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹**

```bash
gh issue create --title "[coverage] ãƒ†ã‚¹ãƒˆè¿½åŠ æ™‚ã«ãƒ†ã‚¹ãƒˆå¤±æ•—" --label "coverage,bug,priority:high" --body "$(cat <<EOF
## æ¦‚è¦
ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šä½œæ¥­ä¸­ã«ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚

## è©³ç´°
- **ãƒ–ãƒ©ãƒ³ãƒ**: test/test-agent-${TIMESTAMP}
- **å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆ**: [AgentãŒç‰¹å®š]
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
\`\`\`
[ã‚¨ãƒ©ãƒ¼å†…å®¹]
\`\`\`

## å†ç¾æ‰‹é †
1. ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
2. \`vendor/bin/phpunit [å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆ]\` ã‚’å®Ÿè¡Œ

## å„ªå…ˆåº¦
- **High**: ãƒ†ã‚¹ãƒˆãŒé€šã‚‰ãªã„ãŸã‚ã€ãƒãƒ¼ã‚¸ä¸å¯

## æ¨å¥¨å¯¾å¿œ
[AgentãŒåŸå› ã‚’åˆ†æã—ã¦ææ¡ˆ]
EOF
)"
```

**ã‚±ãƒ¼ã‚¹2: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã«ãƒã‚°ã‚’ç™ºè¦‹**

```bash
gh issue create --title "[coverage] UserService: ãƒ†ã‚¹ãƒˆè¿½åŠ æ™‚ã«ãƒã‚°ç™ºè¦‹" --label "coverage,bug,priority:high" --body "$(cat <<EOF
## æ¦‚è¦
ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šä½œæ¥­ä¸­ã«æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ãƒã‚°ã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚

## è©³ç´°
- **ãƒ•ã‚¡ã‚¤ãƒ«**: \`app/Services/UserService.php\`
- **ãƒ¡ã‚½ãƒƒãƒ‰**: \`updateProfile()\`
- **å•é¡Œ**: nullãƒã‚§ãƒƒã‚¯ãŒä¸è¶³
- **ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸**: 65%
- **ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸**: 75%

## ãƒã‚°ã®è©³ç´°
\`\`\`php
// å•é¡Œã®ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼‰
public function updateProfile(\$userId, \$data)
{
    \$user = User::find(\$userId);
    // nullãƒã‚§ãƒƒã‚¯ãŒä¸è¶³ â†’ \$userãŒnullã®å ´åˆã‚¨ãƒ©ãƒ¼
    \$user->update(\$data);
}
\`\`\`

## æœŸå¾…ã™ã‚‹å‹•ä½œ
nullãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼

## å„ªå…ˆåº¦
- **High**: ãƒ‡ãƒ¼ã‚¿ç ´æã®å¯èƒ½æ€§

## é–¢é€£ãƒ–ãƒ©ãƒ³ãƒ
- \`test/test-agent-${TIMESTAMP}\`

## æ¨å¥¨å¯¾å¿œ
1. æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ï¼ˆnullãƒã‚§ãƒƒã‚¯è¿½åŠ ï¼‰
2. ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ï¼ˆnullã‚±ãƒ¼ã‚¹ã‚’ã‚«ãƒãƒ¼ï¼‰
EOF
)"
```

**ã‚±ãƒ¼ã‚¹3: ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä¸ŠãŒã‚‰ãªã„**

```bash
gh issue create --title "[coverage] UserService: ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™æœªé”" --label "coverage,priority:medium" --body "$(cat <<EOF
## æ¦‚è¦
ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ãŸãŒã€ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒç›®æ¨™å€¤ã«é”ã—ã¾ã›ã‚“ã§ã—ãŸã€‚

## è©³ç´°
- **ãƒ•ã‚¡ã‚¤ãƒ«**: \`app/Services/UserService.php\`
- **ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸**: 65%
- **è¿½åŠ å¾Œã®ã‚«ãƒãƒ¬ãƒƒã‚¸**: 68%ï¼ˆ+3%ï¼‰
- **ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸**: 75%ï¼ˆ+10%ï¼‰

## åŸå› åˆ†æ
[AgentãŒåˆ†æ]
- è¤‡é›‘ãªåˆ†å²ãŒå¤šãã€ãƒ†ã‚¹ãƒˆè¿½åŠ ãŒå›°é›£
- å¤–éƒ¨APIä¾å­˜ãŒå¼·ãã€ãƒ¢ãƒƒã‚¯åŒ–ãŒå¿…è¦
- etc.

## å„ªå…ˆåº¦
- **Medium**: æ©Ÿèƒ½ã¯å•é¡Œãªã—ã€ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šã¯ç¶™ç¶šèª²é¡Œ

## æ¨å¥¨å¯¾å¿œ
[AgentãŒææ¡ˆ]
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§è¤‡é›‘åº¦ã‚’ä¸‹ã’ã‚‹
- ä¾å­˜æ€§æ³¨å…¥ã§ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã‚’å‘ä¸Š
- etc.
EOF
)"
```

**Issueä½œæˆå¾Œ**:
- Issue URLã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š
- å•é¡Œã®è¦ç´„ã‚’æç¤º
- **ãƒ–ãƒ©ãƒ³ãƒã¯pushã—ãªã„**ï¼ˆå•é¡ŒãŒã‚ã‚‹ãŸã‚ï¼‰

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### åŸºæœ¬æ–¹é‡

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªã‚’å–ã‚‹**:
   - æƒ³å®šå¤–ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Šã—ã¦æŒ‡ç¤ºã‚’ä»°ã
   - è‡ªå‹•ã§åˆ¤æ–­ã›ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„æ€ã‚’ç¢ºèª

2. **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯è§¦ã‚‰ãªã„**:
   - æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ãƒã‚°ã‚„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãŒå¿…è¦ãªå ´åˆã¯ã€Issueä½œæˆã§å ±å‘Š
   - ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šã¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã¯åˆ¥ã®ã‚µã‚¤ã‚¯ãƒ«ã§å®Ÿæ–½

3. **å¤±æ•—æ™‚ã¯Issueä½œæˆ**:
   - ãƒ†ã‚¹ãƒˆå¤±æ•—ã€ãƒã‚°ç™ºè¦‹ã€ç›®æ¨™æœªé”ã®å ´åˆã¯Issueä½œæˆ
   - ãƒ–ãƒ©ãƒ³ãƒã¯pushã›ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ¤æ–­ã‚’å§”ã­ã‚‹

### å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹

| ã‚¨ãƒ©ãƒ¼ | å¯¾å¿œ |
|--------|------|
| PHPUnitå®Ÿè¡Œã‚¨ãƒ©ãƒ¼ | Bashãƒ„ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š |
| ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆè§£æå¤±æ•— | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç¢ºèªã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š |
| å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ | git logã®çµæœã‚’ç¢ºèªã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š |
| ãƒ†ã‚¹ãƒˆè¿½åŠ æ™‚ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ | ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Šã—ã€ä¿®æ­£ã‚’ä¾é ¼ |
| PHPStan Level 8ã§è§£æ±ºä¸å¯ | Level 7ã§å¦¥å”ã™ã‚‹ã‹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèª |
| gh CLIèªè¨¼ã‚¨ãƒ©ãƒ¼ | `gh auth status`ã‚’ç¢ºèªã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š |

---

## åˆ¶ç´„äº‹é …

### å¿…é ˆæ¡ä»¶

1. **PHPUnit + Xdebug/PCOV**: ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šã«å¿…è¦
2. **gh CLI**: PR/Issueä½œæˆã«å¿…è¦ï¼ˆ`gh auth login`æ¸ˆã¿ï¼‰
3. **git**: ãƒ–ãƒ©ãƒ³ãƒä½œæˆã€ã‚³ãƒŸãƒƒãƒˆã«å¿…è¦
4. **Laravel**: `composer.json`ã«`laravel/framework`ãŒå­˜åœ¨

### æ¨å¥¨æ¡ä»¶

1. **developãƒ–ãƒ©ãƒ³ãƒ**: PRã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã¨ã—ã¦ä½¿ç”¨
2. **æ—¢å­˜ãƒ†ã‚¹ãƒˆ**: ã‚ã‚‹ç¨‹åº¦ã®ãƒ†ã‚¹ãƒˆãŒæ—¢ã«å­˜åœ¨ã™ã‚‹æ–¹ãŒæ§‹é€ ã‚’å‚è€ƒã«ã—ã‚„ã™ã„

---

## å®Ÿè¡Œä¾‹

```bash
# TDDã‚µã‚¤ã‚¯ãƒ«å®Œäº†å¾Œã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ãƒã‚§ãƒƒã‚¯
php artisan test --coverage

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä¸‹ãŒã£ã¦ã„ãŸã‚‰å®Ÿè¡Œ
/test-agent
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šä¸­...
ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸: 72.41%
ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸: 82.41%

å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«é¸å®šä¸­...
å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå„ªå…ˆé †ä½é †ï¼‰:
1. app/Services/UserService.php (ã‚«ãƒãƒ¬ãƒƒã‚¸: 65%, æ›´æ–°é »åº¦: 12å›)
2. app/Http/Controllers/AuthController.php (ã‚«ãƒãƒ¬ãƒƒã‚¸: 58%, æ›´æ–°é »åº¦: 8å›)
...

Task Agentèµ·å‹•ä¸­...
ãƒ–ãƒ©ãƒ³ãƒä½œæˆ: test/test-agent-20251118-1115
ãƒ†ã‚¹ãƒˆè¿½åŠ ä¸­...
PHPStanå¯¾å¿œä¸­...
ã‚«ãƒãƒ¬ãƒƒã‚¸å†æ¸¬å®šä¸­...

çµæœ:
ã‚«ãƒãƒ¬ãƒƒã‚¸: 72.41% â†’ 78.52% (+6.11%)
ãƒ†ã‚¹ãƒˆ: 47 passed
PHPStan: Level 8 (0 errors)

PRä½œæˆä¸­...
PRä½œæˆå®Œäº†: https://github.com/yourname/yourrepo/pull/123
```

---

## æ³¨æ„äº‹é …

1. **å®Ÿè¡Œæ™‚é–“**: å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚„ãƒ†ã‚¹ãƒˆæ•°ã«ã‚ˆã‚Šã€æ•°åˆ†ã€œæ•°ååˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
2. **ãƒ–ãƒ©ãƒ³ãƒ**: è‡ªå‹•ã§ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã™ã‚‹ãŸã‚ã€äº‹å‰ã«ä½œæ¥­ä¸­ã®å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãã ã•ã„
3. **ä¸¦è¡Œå®Ÿè¡Œ**: è¤‡æ•°ã®ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šä½œæ¥­ã‚’åŒæ™‚ã«å®Ÿè¡Œã—ãªã„ã§ãã ã•ã„ï¼ˆãƒ–ãƒ©ãƒ³ãƒåãŒè¡çªã—ã¾ã™ï¼‰
4. **ãƒ¬ãƒ“ãƒ¥ãƒ¼**: PRã¯å¿…ãšäººé–“ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã‹ã‚‰ãƒãƒ¼ã‚¸ã—ã¦ãã ã•ã„

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒæ¸¬å®šã§ããªã„

```bash
# XdebugãŒæœ‰åŠ¹ã‹ç¢ºèª
php -v | grep Xdebug

# ã¾ãŸã¯ PCOVãŒæœ‰åŠ¹ã‹ç¢ºèª
php -v | grep PCOV

# composer.jsonã®require-devã‚’ç¢ºèª
grep -E "xdebug|pcov" composer.json
```

### gh CLIãŒèªè¨¼ã•ã‚Œã¦ã„ãªã„

```bash
# èªè¨¼çŠ¶æ…‹ç¢ºèª
gh auth status

# ãƒ­ã‚°ã‚¤ãƒ³
gh auth login
```

### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸å®šã•ã‚Œãªã„

```bash
# ç›´è¿‘1ãƒ¶æœˆã®æ›´æ–°å±¥æ­´ã‚’ç¢ºèª
git log --since="1 month ago" --name-only --pretty=format: | \
  grep "\.php$" | head -20
```

ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒæ—¢ã«é«˜ã„ï¼ˆ90%ä»¥ä¸Šï¼‰å ´åˆã€å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸å®šã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
