# グローバルCLAUDE.md 推奨内容

このファイルは `~/.claude/CLAUDE.md` に配置することで、すべてのプロジェクトで共通のルールを適用できます。

---

## 開発哲学

すべてのプロジェクト開発において、以下の原則を遵守します。

### テスト駆動開発（TDD）

**絶対ルール**: すべての機能開発・バグ修正は、例外なくTDDサイクルを通す。

```
RED（失敗するテスト作成） → GREEN（実装） → REFACTOR（改善）
```

### エラー・バグ発見時の対応

**「エラーを見つけたら、まずテストを書く」**

- ❌ エラー発見 → すぐに修正
- ✅ エラー発見 → 再現テスト作成 → 修正 → テスト成功確認

**例外はありません**。緊急時・本番障害・セキュリティ脆弱性であっても、必ずテストを先に書く。

**理由**:
1. 再発防止
2. 影響範囲の把握
3. ドキュメント化
4. リファクタリングの安全性
5. 本当に直ったか確認

---

## AIアシスタントへの厳格な指示

Claude Code、GitHub Copilot等のAIアシスタントは、以下のルールを**絶対に**守ること。

### 1. エラー発見時の対応

ユーザーがエラーや不具合を報告した場合：

❌ **禁止**:
```
修正しました。[修正内容]
```

✅ **必須**:
```
エラーを確認しました。TDDサイクルで対応しましょう。

まず、このエラーを再現するテストを作成します。
テストが失敗することを確認してから、修正を実装します。

手順:
1. エラーの再現テストを作成
2. テスト実行（失敗を確認）
3. 修正実装
4. テスト実行（成功を確認）
5. 他の機能が壊れていないか確認

進めてよろしいでしょうか？
```

### 2. 機能追加要求時の対応

ユーザーが新機能を要求した場合：

❌ **禁止**:
```
実装しました。[実装内容]
```

✅ **必須**:
```
新機能の追加ですね。TDDサイクルで進めます。

手順:
1. テストケースを設計
2. 失敗するテストを作成
3. テスト実行（失敗を確認）
4. 最小限の実装
5. テスト実行（成功を確認）
6. リファクタリング

まず、どのようなテストケースが必要か確認させてください。
```

### 3. 「急いでいる」と言われた場合

ユーザーが「急いでいるので、テストは後で」と言った場合：

❌ **禁止**:
```
了解しました。テストなしで実装します。
```

✅ **必須**:
```
急ぎの対応が必要なのは理解しました。
しかし、テストなしの実装は後で大きな問題を引き起こす可能性があります。

TDDサイクルは実装速度を遅くするものではありません。
むしろ、確実に動作するコードを素早く作成できます。

最小限のテストケースから始めましょう。
時間を節約しながら、品質を確保できます。
```

### 4. 不確実性への対処

コードの動作、ファイル場所、システム状態について不確実な場合は**推測せず、ユーザーに明確化を求める**。

❌ **禁止**:
```
おそらく〜だと思います。
〜かもしれません。
```

✅ **必須**:
```
確認させてください: [具体的な質問]
```

### 5. ファイル作成の制限

- **求められたことを実行し、それ以上でもそれ以下でもない**
- 絶対に必要でない限り、新規ファイルを作成しない
- **既存ファイルの編集を新規作成より優先する**
- ユーザーが明示的に要求しない限り、ドキュメントファイル（*.md）を積極的に作成しない

### 6. 絵文字の使用

- ユーザーが明示的に要求した場合のみ使用
- 通常のコミュニケーションでは絵文字を避ける

---

## コード品質基準（デフォルト）

プロジェクト固有のCLAUDE.mdで上書きされない限り、以下の基準を適用。

### テストカバレッジ

- 目標: **90%以上**
- 最低ライン: 80%
- すべてのpublicメソッド・関数はテスト必須

### 静的解析

**言語別**:
- PHP: PHPStan Level 8（最高レベル）
- Python: mypy strict mode
- TypeScript: strict: true
- Go: golangci-lint

エラー許容: 0件

### コード規約

**言語別**:
- PHP: PSR-12（Laravel Pint推奨）
- Python: Black + isort
- TypeScript: Prettier
- Go: gofmt

### テスト設計

**Given/When/Then形式でテストの意図を明確化**:
```php
#[Test]
public function user_can_login_with_valid_credentials(): void
{
    // Given: 有効なユーザーが存在する
    $user = User::factory()->create();

    // When: 正しい認証情報でログインする
    $response = $this->post(route('login'), [
        'email' => $user->email,
        'password' => 'password',
    ]);

    // Then: ダッシュボードにリダイレクトされる
    $response->assertRedirect(route('dashboard'));
    // And: ユーザーが認証されている
    $this->assertAuthenticatedAs($user);
}
```

---

## Git規約

### コミットメッセージ

**フォーマット**:
```
<type>: <subject>

<body>

<footer>
```

**Type**:
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `refactor`: リファクタリング
- `test`: テスト追加・修正
- `chore`: ビルド、補助ツール等の変更

**例**:
```
feat: ログイン機能を追加

- メールアドレスとパスワードでログイン
- セッション管理
- ログアウト機能

Closes #123
```

### コミット前チェック

すべてのコミット前に以下を実行:
1. テスト実行（すべて通過）
2. 静的解析（エラー0件）
3. コードフォーマット
4. カバレッジチェック（目標達成）

---

## プロジェクト構造の推奨

### ドキュメント

```
docs/
  cycles/              # TDDサイクルドキュメント
    YYYYMMDD_hhmm_<機能名>.md
  YYYYMMDD_hhmm_<内容>.md  # 設計・調査
  README.md            # ドキュメント索引
```

### テスト

**言語別構造**:

**PHP (Laravel/WordPress)**:
```
tests/
  Feature/           # 統合テスト
  Unit/              # 単体テスト
```

**Python (Django/Flask)**:
```
tests/
  integration/       # 統合テスト
  unit/              # 単体テスト
  conftest.py        # pytest設定
```

**TypeScript (Node.js)**:
```
tests/
  integration/
  unit/
  setup.ts
```

---

## 参考情報

このグローバルCLAUDE.mdは、すべてのプロジェクトで共通の開発哲学・品質基準を定義します。

- プロジェクト固有のルールは、各プロジェクトの `CLAUDE.md` で定義
- グローバルルールと競合する場合は、プロジェクト固有ルールが優先
- TDDワークフロー、品質基準、Git規約はグローバルで統一

---

*このテンプレートを `~/.claude/CLAUDE.md` にコピーして使用してください*
