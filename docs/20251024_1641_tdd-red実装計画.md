# Laravel用tdd-red Skill 実装計画

**作成日時**: 2025-10-24 16:41
**対象**: templates/laravel/.claude/skills/tdd-red/

---

## ユーザーストーリー

**As a** Laravel開発者
**I want to** REDフェーズでテストコードのみを作成したい
**So that** TDDサイクルに従って、実装前にテストを書くことができる

---

## 受け入れ基準

### シナリオ1: tdd-red Skillが正しく発動する

**Given** ユーザーがLaravelプロジェクトで作業している
**And** PLAN.mdが存在する
**When** 以下のいずれかの条件を満たす
  - ユーザーが「red」「テスト」「テスト作成」と言う
  - `/tdd-red` コマンドを実行する
  - PLANフェーズが完了して次のフェーズへ進む
**Then** tdd-red Skillが自動的に読み込まれる
**And** PLAN.mdのテストケース一覧を読み込む

### シナリオ2: PLAN.mdを基にテストを作成する

**Given** tdd-red Skillが発動している
**And** PLAN.mdにテストケース一覧が記載されている
**When** Skillがテストケースをユーザーに確認する
**Then** 各テストケースについてテストコードを作成する
**And** tests/Feature/ または tests/Unit/ に配置する
**And** Given/When/Thenコメントで意図を明確にする

### シナリオ3: 実装コードを書かない制約が効く

**Given** tdd-red Skillが発動している
**When** Claude Codeがテストを作成しようとする
**Then** tests/ ディレクトリのみ書き込み可能
**And** app/, database/, routes/ 等への書き込みが禁止される

### シナリオ4: テストが失敗（Red状態）になる

**Given** テストコードが作成された
**When** テストを実行する
**Then** すべてのテストが失敗する（実装がないため）
**And** ユーザーに次のフェーズ（GREEN）を案内する

---

## 実装範囲

### 対象ファイル

新規作成:
- `templates/laravel/.claude/skills/tdd-red/SKILL.md` - tdd-red Skillの定義

### 対象外

- テストテンプレートファイル（必要に応じて将来追加）
- スラッシュコマンド（後のフェーズで実装）
- 他のSkills

---

## アーキテクチャ設計

### ファイル構成

```
templates/laravel/.claude/skills/tdd-red/
└── SKILL.md                      # Skill定義
```

### SKILL.mdの構造

```yaml
---
name: tdd-red
description: REDフェーズ用。テストコードのみを作成し、実装コードは一切書かない。ユーザーが「red」「テスト」「テスト作成」と言った時、PLANフェーズ完了後、または /tdd-red コマンド実行時に使用。PLAN.mdのテストケース一覧を基にPHPUnit #[Test]属性形式でテストを作成。
allowed-tools: Read, Write, Grep, Glob
---

# TDD RED Phase

[Skillの詳細内容]
```

### Skillの振る舞い

1. **発動時**
   - PLAN.mdを読み込む（`docs/tdd/PLAN.md`）
   - テストケース一覧セクションを抽出
   - 既存のテストディレクトリ構造を確認

2. **テスト作成フェーズ**
   - Feature Testsから作成開始
   - ファイル名とテストケース概要をユーザーに確認
   - PHPUnit #[Test]属性形式でテストコードを生成
   - Given/When/Thenコメントで構造化
   - tests/Feature/ または tests/Unit/ に配置

3. **テストコード構造**

   **PHPUnit #[Test]属性形式（Laravel 11 / PHPUnit 10-11推奨）**:
   ```php
   <?php

   namespace Tests\Feature;

   use App\Models\User;
   use PHPUnit\Framework\Attributes\Test;
   use Tests\TestCase;

   class ProfileControllerTest extends TestCase
   {
       #[Test]
       public function user_can_update_their_profile(): void
       {
           // Given: ログイン済みユーザーがいる
           $user = User::factory()->create(['name' => 'Old Name']);
           $this->actingAs($user);

           // When: プロフィールを更新する
           $response = $this->post('/profile', ['name' => 'New Name']);

           // Then: 成功メッセージが表示される
           $response->assertSessionHas('success');

           // And: 名前が更新されている
           $this->assertEquals('New Name', $user->fresh()->name);
       }

       #[Test]
       public function validation_error_is_shown_when_name_is_empty(): void
       {
           // Given: ログイン済みユーザーがいる
           $user = User::factory()->create();
           $this->actingAs($user);

           // When: 空の名前で更新する
           $response = $this->post('/profile', ['name' => '']);

           // Then: バリデーションエラーが表示される
           $response->assertSessionHasErrors('name');
       }
   }
   ```

   **重要なポイント**:
   - `use PHPUnit\Framework\Attributes\Test;` をインポート
   - `#[Test]` 属性でテストメソッドをマーク
   - メソッド名は `snake_case` 形式（test_プレフィックス不要）
   - 戻り値の型は `: void` を明示
   - Given/When/Then/Andコメントで構造を明確化

4. **テスト実行フェーズ**
   - テスト作成後、実行コマンドを提示
   - 全テストが失敗することを確認するよう促す
   - 失敗理由（実装がない）を説明

5. **完了フェーズ**
   - 作成したテストファイル一覧を表示
   - 次のフェーズ（GREEN）を案内
   - GREENフェーズでテストを通すよう促す

---

## テストケース一覧

このプロジェクトはSkillsの実装なので、テストは手動確認になります。

### 手動テストケース

1. **Skill発動テスト**
   - 条件: Laravelプロジェクトで「red」と発言
   - 期待: tdd-red Skillが読み込まれる

2. **PLAN.md読み込みテスト**
   - 条件: Skill発動後
   - 期待: PLAN.mdのテストケース一覧が表示される

3. **Feature Test作成テスト**
   - 条件: Feature Testの作成を依頼
   - 期待: tests/Feature/XXXTest.php が作成される
   - 期待: Given/When/Thenコメントが含まれる

4. **Unit Test作成テスト**
   - 条件: Unit Testの作成を依頼
   - 期待: tests/Unit/XXXTest.php が作成される

5. **#[Test]属性使用テスト**
   - 条件: テストを作成
   - 期待: `use PHPUnit\Framework\Attributes\Test;` がインポートされる
   - 期待: `#[Test]` 属性が各テストメソッドに付与される
   - 期待: メソッド名が `snake_case` 形式

6. **制約テスト（実装コードを書かない）**
   - 条件: REDフェーズ中に「実装して」と依頼
   - 期待: 「REDフェーズでは実装できません」と拒否される

7. **テスト実行案内テスト**
   - 条件: すべてのテスト作成完了
   - 期待: テスト実行コマンドが提示される
   - 期待: 失敗することを確認するよう促される

---

## 見積もり

- SKILL.md作成: 45分
- 動作確認（手動テスト）: 30分
- ドキュメント更新: 15分

**合計**: 約1時間30分

---

## 依存関係

### 前提条件
- PLAN.mdが存在すること（tdd-plan Skillで作成）
- PLAN.mdにテストケース一覧が記載されていること

### 今後の依存
- `tdd-green` Skillが、このフェーズで作成したテストを参照する

---

## リスク

### リスク1: PLAN.mdが存在しない
**発生条件**: PLANフェーズをスキップした場合
**対策**: PLAN.mdの存在を確認し、なければPLANフェーズから始めるよう促す

### リスク2: 古いPHPUnitバージョンでの互換性
**発生条件**: PHPUnit 9以下を使用している場合
**対策**: `#[Test]`属性が使えない場合は`test_`プレフィックス形式にフォールバック

### リスク3: テストの粒度が不適切
**発生条件**: PLAN.mdのテストケース記述が曖昧
**対策**: ユーザーに具体的なテストケースを確認

---

## 次のステップ

1. [完了] PLAN作成（このドキュメント）
2. [次] PLAN REVIEW（ユーザー承認）
3. [未] RED（手動テストケース作成）
4. [未] GREEN（SKILL.md実装）
5. [未] REFACTOR（内容の洗練）
6. [未] REVIEW（動作確認）
7. [未] DOC（README更新）
8. [未] COMMIT

---

*作成日時: 2025-10-24 16:41*
*次のフェーズ: PLAN REVIEW*
