# テストリストアプローチ組み込み設計

**作成日時**: 2025-11-05 01:00
**目的**: Kent BeckのTDD原典に基づく「テストリスト」アプローチをClaudeSkillsに組み込む

---

## 背景

### 課題

TDDサイクル実行中（例: GREENフェーズ）に別のタスクや問題に気づいた場合、どう対応すべきか明確なガイドラインがない：

- 別のバグを発見
- 関連する機能の改善点に気づく
- リファクタリングが必要な箇所を発見
- テストケースの不足に気づく

→ **今すぐ対応すべき？それとも今のサイクルを完了すべき？**

### Kent Beckの原典での解決方法

Kent Beckの TDD では「テストリスト」が中核的な役割を果たしている：

**TDDの正式な5ステップ**:
1. **テストリストを書く**（シナリオをリストアップ）
2. テストリストから1つ選んで実行可能なテストコードに変換
3. プロダクトコードを変更してテストを成功させる **（その過程で気づいたことはテストリストに追加する）**
4. 必要に応じてリファクタリング
5. テストリストが空になるまで2に戻る

**重要なポイント**:
- TDDは「Red-Green-Refactor」ではなく、正確には **「List-Red-Green-Refactor」**
- **テストリスト**がTDDの出発点であり、気づきの受け皿
- 実装中に気づいたことは**今すぐ対応せず、テストリストに追加して後で対応**

参考: [Kent Beckのテスト駆動開発の定義 - t-wadaのブログ](https://t-wada.hatenablog.jp/entry/canon-tdd-by-kent-beck)

---

## 目標

ClaudeSkills TDDフレームワークに「テストリスト」アプローチを組み込み、実装中の気づきを適切に管理できるようにする。

---

## 設計方針

### 1. TDDドキュメントテンプレートの拡張

現在の `PLAN.md.template` の「テストケース一覧」セクションを拡張し、以下の状態管理を可能にする：

```markdown
## テストケース一覧

### 実装予定（TODO）
- [ ] TC-01: ユーザー登録：正常系
- [ ] TC-02: ユーザー登録：メールアドレス重複
- [ ] TC-03: ログイン：正常系

### 実装中（WIP: Work In Progress）
- [WIP] TC-01: ユーザー登録：正常系 ← 現在作業中

### 実装中に気づいた追加テスト（DISCOVERED）
- [ ] TC-04: パスワードリセット機能（GREEN中に気づいた - Priority: Low）
- [ ] TC-05: セッション有効期限（REFACTOR中に気づいた - Priority: High）
- [ ] TC-06: ユーザー削除のエラーハンドリング（GREEN中に気づいた - Priority: Medium）

### 完了（DONE）
- [x] TC-01: ユーザー登録：正常系
```

**セクションの役割**:
- **実装予定**: 最初のPLANフェーズで定義したテストケース
- **実装中**: 現在作業中のテストケース（1個のみ）
- **実装中に気づいた追加テスト**: RED/GREEN/REFACTOR中に発見した新しいテストケース
- **完了**: 実装・テスト完了済み

### 2. 各Skillへのガイドライン追加

#### tdd-init Skill

**追加内容**:
```markdown
## テストリストアプローチ

このフレームワークはKent Beckの原典に基づく「テストリスト」アプローチを採用しています。

### テストリストとは？

開発中に実装すべきテストケースを管理するリストです。

### 重要な原則

1. **気づいたことはテストリストに追加**
   - 実装中に新しいテストケースに気づいた → テストリストに追加
   - 別のバグを発見 → テストリストに追加
   - リファクタリング箇所を発見 → テストリストに追加

2. **今のタスクに集中**
   - 気づいたことを記録したら、今のタスクに戻る
   - 今のTDDサイクルを完了してから次のタスクへ

3. **優先度で管理**
   - Priority: High（次のサイクルで対応）
   - Priority: Medium（近いうちに対応）
   - Priority: Low（時間があれば対応）

### テストリストの更新タイミング

- **INITフェーズ**: 初期テストリスト作成
- **PLANフェーズ**: テストケース詳細化
- **RED/GREEN/REFACTORフェーズ**: 気づきを追加
- **REVIEWフェーズ**: テストリストの完了確認
```

#### tdd-plan Skill

**追加内容**:
```markdown
## テストケース一覧の作成

テストケース一覧は、Kent Beckの「テストリスト」アプローチに基づいています。

### セクション構成

テストケース一覧は以下のセクションで管理します：

1. **実装予定（TODO）**
   - PLANフェーズで定義したテストケース
   - 優先度順に並べる

2. **実装中（WIP）**
   - 現在作業中のテストケース（1個のみ）

3. **実装中に気づいた追加テスト（DISCOVERED）**
   - RED/GREEN/REFACTOR中に発見した新しいテストケース
   - Priority（High/Medium/Low）を記載

4. **完了（DONE）**
   - 実装・テスト完了済み

### テンプレート例

```markdown
## テストケース一覧

### 実装予定（TODO）
- [ ] TC-01: ユーザー登録：正常系
- [ ] TC-02: ユーザー登録：メールアドレス重複エラー
- [ ] TC-03: ログイン：正常系

### 実装中（WIP）
（まだなし）

### 実装中に気づいた追加テスト（DISCOVERED）
（実装中に追加される）

### 完了（DONE）
（まだなし）
```

### テストケースの命名規則

- `TC-XX`: テストケースID（連番）
- 概要: 簡潔な説明（「何をテストするか」）

例:
- TC-01: ユーザー登録：正常系
- TC-02: ユーザー登録：メールアドレス重複エラー
```

#### tdd-red Skill

**追加内容**:
```markdown
## テストリストの更新

REDフェーズでテストコードを作成中に新しいテストケースに気づいた場合：

### 手順

1. TDDドキュメントを開く
2. 「## テストケース一覧」の「### 実装中に気づいた追加テスト（DISCOVERED）」に追記:
   ```markdown
   - [ ] TC-XX: [新しいテストケース]（RED中に気づいた - Priority: [High/Medium/Low]）
   ```
3. 今のテストコード作成に戻る

### 例

テストコード作成中に「メールアドレス形式のバリデーションが必要」と気づいた場合：

```markdown
### 実装中に気づいた追加テスト（DISCOVERED）
- [ ] TC-04: ユーザー登録：メールアドレス形式バリデーション（RED中に気づいた - Priority: High）
```

### 緊急度の判断

- **Priority: High**: 今実装中の機能に直接影響（次のサイクルで対応）
- **Priority: Medium**: 関連性が高い（近いうちに対応）
- **Priority: Low**: 将来的に必要（時間があれば対応）

### 重要な原則

**今のタスクに集中**:
- 気づきを記録したら、今のテストコード作成に戻る
- 新しいテストケースは次のサイクルで対応
```

#### tdd-green Skill

**追加内容**:
```markdown
## テストリストの更新

GREENフェーズで実装中に以下のような気づきがあった場合：
- 別の機能の必要性
- バグの発見
- 新しいテストケースの必要性

### 手順

1. TDDドキュメントを開く
2. 「## テストケース一覧」の「### 実装中に気づいた追加テスト（DISCOVERED）」に追記:
   ```markdown
   - [ ] TC-XX: [気づいた内容]（GREEN中に気づいた - Priority: [High/Medium/Low]）
   ```
3. 今の実装に戻る

### 例

実装中に「ユーザー削除のエラーハンドリングがない」と気づいた場合：

```markdown
### 実装中に気づいた追加テスト（DISCOVERED）
- [ ] TC-05: ユーザー削除：エラーハンドリング（GREEN中に気づいた - Priority: Medium）
```

### 緊急度の判断

**今すぐ対応すべきか？**

1. **緊急（今のタスクに影響）** → 今すぐ対応
   - 今のテストが通らない原因
   - セキュリティ脆弱性
   - データ損失の可能性

2. **重要（関連性高い）** → テストリストに追加（Priority: High）
   - 今実装中の機能の一部
   - 密接に関連するリファクタリング

3. **通常（関連性低い）** → テストリストに追加（Priority: Medium/Low）
   - 別機能のバグ
   - 一般的なリファクタリング
   - ドキュメント整備

### 重要な原則

**今のタスクに集中**:
- 気づきを記録したら、今の実装に戻る
- 新しいタスクは次のサイクルで対応
- GREENフェーズは「テストを通す」ことに集中
```

#### tdd-refactor Skill

**追加内容**:
```markdown
## テストリストの更新

REFACTORフェーズでリファクタリング中に以下のような気づきがあった場合：
- 別のリファクタリング箇所
- 新しい機能のアイデア
- コードの臭い（Code Smell）

### 手順

1. TDDドキュメントを開く
2. 「## テストケース一覧」の「### 実装中に気づいた追加テスト（DISCOVERED）」に追記:
   ```markdown
   - [ ] TC-XX: [気づいた内容]（REFACTOR中に気づいた - Priority: [High/Medium/Low]）
   ```
3. 今のリファクタリングに戻る

### 例

リファクタリング中に「UserServiceの責務が大きすぎる」と気づいた場合：

```markdown
### 実装中に気づいた追加テスト（DISCOVERED）
- [ ] TC-06: UserServiceの責務分離リファクタリング（REFACTOR中に気づいた - Priority: Low）
```

### 重要な原則

**今のリファクタリングに集中**:
- 気づきを記録したら、今のリファクタリングに戻る
- 別のリファクタリングは次のサイクルで対応
- REFACTORフェーズは「今のコードを改善する」ことに集中
```

#### tdd-review Skill

**追加内容**:
```markdown
## テストリストの確認

REVIEWフェーズでは、テストリストの状態を確認します。

### 確認項目

1. **完了したテストケース**
   - 「### 完了（DONE）」セクションに移動済みか？
   - すべてのテストが通っているか？

2. **実装中に気づいた追加テスト**
   - 「### 実装中に気づいた追加テスト（DISCOVERED）」に記録されているか？
   - 優先度（Priority）が設定されているか？

3. **次のサイクルの計画**
   - Priority: Highのテストケースがある場合、次のサイクルで対応

### テストリストの整理

REVIEWフェーズで以下を実施：

1. 完了したテストケースを「完了（DONE）」に移動:
   ```markdown
   ### 完了（DONE）
   - [x] TC-01: ユーザー登録：正常系
   ```

2. 追加テストケースの優先度を見直し

3. 次のサイクルで対応すべきテストケースを「実装予定（TODO）」に移動:
   ```markdown
   ### 実装予定（TODO）
   - [ ] TC-04: パスワードリセット機能（前回のGREEN中に気づいた - Priority: High → 次のサイクルで対応）
   ```
```

#### tdd-commit Skill

**追加内容**:
```markdown
## テストリストの状態記録

COMMITフェーズでは、テストリストの現在の状態をコミットメッセージに含めます。

### コミットメッセージに含める内容

```
feat: ユーザー登録機能を実装

実装内容:
- ユーザー登録：正常系
- ユーザー登録：メールアドレス重複エラー

テストリスト状態:
- 完了: TC-01, TC-02
- 次回対応予定（Priority: High）: TC-04（パスワードリセット機能）
- バックログ: TC-05, TC-06

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### 次のサイクルへの引き継ぎ

COMMITフェーズ完了後、次のサイクルを開始する場合：

1. Priority: Highのテストケースを「実装予定（TODO）」の最上位に移動
2. 新しいINITフェーズを開始
3. 既存のTDDドキュメントを継続使用（新規作成しない）
```

---

## 実装計画

### Phase 1: ドキュメントテンプレート更新

#### タスク1: PLAN.md.template 更新

**対象ファイル**:
- `templates/generic/.claude/skills/tdd-plan/templates/PLAN.md.template`
- `templates/laravel/.claude/skills/tdd-plan/templates/PLAN.md.template`
- `templates/bedrock/.claude/skills/tdd-plan/templates/PLAN.md.template`

**変更内容**:
```markdown
## テストケース一覧

### 実装予定（TODO）
- [ ] TC-01: [テストケース概要]
- [ ] TC-02: [テストケース概要]

### 実装中（WIP）
（まだなし）

### 実装中に気づいた追加テスト（DISCOVERED）
（実装中に追加される）

### 完了（DONE）
（まだなし）
```

### Phase 2: Skillファイル更新

#### タスク2: tdd-init Skill 更新

**対象ファイル**:
- `templates/generic/.claude/skills/tdd-init/SKILL.md`
- `templates/laravel/.claude/skills/tdd-init/SKILL.md`
- `templates/bedrock/.claude/skills/tdd-init/SKILL.md`

**追加セクション**: 「テストリストアプローチ」

#### タスク3: tdd-plan Skill 更新

**対象ファイル**:
- `templates/generic/.claude/skills/tdd-plan/SKILL.md`
- `templates/laravel/.claude/skills/tdd-plan/SKILL.md`
- `templates/bedrock/.claude/skills/tdd-plan/SKILL.md`

**追加セクション**: 「テストケース一覧の作成」

#### タスク4: tdd-red Skill 更新

**対象ファイル**:
- `templates/generic/.claude/skills/tdd-red/SKILL.md`
- `templates/laravel/.claude/skills/tdd-red/SKILL.md`
- `templates/bedrock/.claude/skills/tdd-red/SKILL.md`

**追加セクション**: 「テストリストの更新」

#### タスク5: tdd-green Skill 更新

**対象ファイル**:
- `templates/generic/.claude/skills/tdd-green/SKILL.md`
- `templates/laravel/.claude/skills/tdd-green/SKILL.md`
- `templates/bedrock/.claude/skills/tdd-green/SKILL.md`

**追加セクション**: 「テストリストの更新」

#### タスク6: tdd-refactor Skill 更新

**対象ファイル**:
- `templates/generic/.claude/skills/tdd-refactor/SKILL.md`
- `templates/laravel/.claude/skills/tdd-refactor/SKILL.md`
- `templates/bedrock/.claude/skills/tdd-refactor/SKILL.md`

**追加セクション**: 「テストリストの更新」

#### タスク7: tdd-review Skill 更新

**対象ファイル**:
- `templates/generic/.claude/skills/tdd-review/SKILL.md`
- `templates/laravel/.claude/skills/tdd-review/SKILL.md`
- `templates/bedrock/.claude/skills/tdd-review/SKILL.md`

**追加セクション**: 「テストリストの確認」

#### タスク8: tdd-commit Skill 更新

**対象ファイル**:
- `templates/generic/.claude/skills/tdd-commit/SKILL.md`
- `templates/laravel/.claude/skills/tdd-commit/SKILL.md`
- `templates/bedrock/.claude/skills/tdd-commit/SKILL.md`

**追加セクション**: 「テストリストの状態記録」

### Phase 3: ドキュメント更新

#### タスク9: README.md 更新

**追加内容**:
```markdown
## Kent Beckのテストリストアプローチ

このフレームワークは、Kent Beckの原典に基づく「テストリスト」アプローチを採用しています。

### テストリストとは？

TDDの正式なステップは「Red-Green-Refactor」ではなく、「**List**-Red-Green-Refactor」です。

実装中に気づいたことは**今すぐ対応せず、テストリストに追加**し、今のタスクに集中します。

詳細: `docs/20251105_0100_テストリストアプローチ組み込み設計.md`
```

#### タスク10: CLAUDE.md 更新（各テンプレート）

**追加内容**:
```markdown
## テストリストの管理

実装中に新しいテストケースや問題に気づいた場合：

1. TDDドキュメントの「テストケース一覧」に追加
2. Priority（High/Medium/Low）を設定
3. 今のタスクに戻る
4. 次のサイクルで対応

詳細: 各Skillファイルの「テストリストの更新」セクション参照
```

---

## 実装の見積もり

- タスク1（PLAN.md.template更新）: 30分 × 3ファイル = 1.5時間
- タスク2-8（Skillファイル更新）: 30分 × 7フェーズ × 3テンプレート = 10.5時間
- タスク9（README.md更新）: 30分
- タスク10（CLAUDE.md更新）: 30分 × 3テンプレート = 1.5時間

**合計**: 約14時間

---

## テスト計画

### 手動テスト

実際のプロジェクトで以下のシナリオをテスト：

1. **INITフェーズ**: テストリストが正しく作成される
2. **PLANフェーズ**: テストケース一覧が4セクション構成になっている
3. **GREEN中に気づき**: 「実装中に気づいた追加テスト」に追記できる
4. **REVIEWフェーズ**: テストリストが整理される
5. **COMMITフェーズ**: コミットメッセージにテストリスト状態が含まれる

### 期待される効果

- 実装中の気づきを失わない
- 今のタスクに集中できる
- 次のサイクルで何をすべきか明確
- Kent Beckの原典に忠実なTDD実践

---

## リスク

### リスク1: テストリストが複雑になりすぎる

**対策**:
- Priority: Highのみ次のサイクルで対応
- Priority: Low は別のバックログ（GitHub Issues等）に移動

### リスク2: ユーザーがテストリスト更新を忘れる

**対策**:
- 各Skillに「テストリストの更新」セクションを明記
- REVIEWフェーズでテストリスト確認をチェック項目に追加

### リスク3: 既存のTDDドキュメントとの互換性

**対策**:
- 新しいセクション構成は追加のみ（既存セクションは削除しない）
- 既存のTDDドキュメントは手動で移行可能

---

## 次のステップ

1. **このドキュメントをレビュー**
2. **Phase 1から順次実装**
3. **実プロジェクトでテスト**
4. **フィードバックを収集して改善**

---

## 参考資料

- [Kent Beckのテスト駆動開発の定義 - t-wadaのブログ](https://t-wada.hatenablog.jp/entry/canon-tdd-by-kent-beck)
- Kent Beck『テスト駆動開発』（オーム社、2017年）
- Kent Beck『Test-Driven Development: By Example』（Addison-Wesley、2002年）

---

*このドキュメントはClaudeSkillsプロジェクトの一部です*
