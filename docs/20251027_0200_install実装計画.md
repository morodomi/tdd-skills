# Laravel用install.sh 実装計画

**作成日時**: 2025-10-27 02:00
**対象**: templates/laravel/install.sh

---

## ユーザーストーリー

**As a** Laravel開発者
**I want to** 既存のLaravelプロジェクトにClaudeSkills TDD環境を簡単に導入したい
**So that** すぐにTDD開発を開始できる

---

## 受け入れ基準

### シナリオ1: install.shが正しく実行される

**Given** 既存のLaravelプロジェクトがある
**When** install.shを実行する
**Then** すべてのSkillsとディレクトリが正しくインストールされる
**And** エラーなく完了する

### シナリオ2: Laravelプロジェクトであることを確認する

**Given** install.shを実行する
**When** 現在のディレクトリがLaravelプロジェクトでない
**Then** エラーメッセージを表示する
**And** インストールを中断する

### シナリオ3: 既存のインストールを検出する

**Given** install.shを実行する
**When** .claude/skills/ディレクトリが既に存在する
**Then** 警告メッセージを表示する
**And** 上書きするか確認する

### シナリオ4: インストール成功を報告する

**Given** install.shが正常に完了する
**Then** 成功メッセージを表示する
**And** 次のステップ（/tdd-init実行）を案内する
**And** インストールされたファイルの一覧を表示する

---

## 実装範囲

### 対象ファイル

新規作成:
- `templates/laravel/install.sh` - インストールスクリプト

### インストールされるファイル/ディレクトリ

プロジェクトに作成されるもの:
- `.claude/skills/tdd-init/SKILL.md`
- `.claude/skills/tdd-plan/SKILL.md`
- `.claude/skills/tdd-plan/templates/PLAN.md.template`
- `.claude/skills/tdd-red/SKILL.md`
- `.claude/skills/tdd-green/SKILL.md`
- `.claude/skills/tdd-refactor/SKILL.md`
- `.claude/skills/tdd-review/SKILL.md`
- `docs/tdd/.gitkeep`
- `CLAUDE.md` (オプション、既存ファイルがない場合のみ)

### 対象外

- スラッシュコマンド（.claude/commands/）は将来実装予定
- laravel-quality Skill（将来実装予定）
- 既存のCLAUDE.mdの上書き（安全のため）

---

## アーキテクチャ設計

### ファイル構成

```
templates/laravel/
├── install.sh                    # インストールスクリプト
├── .claude/
│   └── skills/
│       ├── tdd-init/
│       ├── tdd-plan/
│       ├── tdd-red/
│       ├── tdd-green/
│       ├── tdd-refactor/
│       └── tdd-review/
└── CLAUDE.md.template            # オプション
```

### install.shの構造

```bash
#!/bin/bash

# 1. 環境チェック
#    - Laravelプロジェクトか確認
#    - 必要なコマンドの存在確認

# 2. 既存インストールチェック
#    - .claude/skills/の存在確認
#    - 上書き確認

# 3. ディレクトリ作成
#    - .claude/skills/
#    - docs/tdd/

# 4. ファイルコピー
#    - すべてのSkills
#    - PLAN.md.template
#    - CLAUDE.md（オプション）

# 5. 完了メッセージ
#    - インストールされたファイル一覧
#    - 次のステップ案内
```

### 実行方法

#### ローカルインストール（開発中）

```bash
cd /path/to/your-laravel-project
bash /path/to/ClaudeSkills/templates/laravel/install.sh
```

#### リモートインストール（公開後）

```bash
cd /path/to/your-laravel-project
curl -fsSL https://raw.githubusercontent.com/yourname/ClaudeSkills/main/templates/laravel/install.sh | bash
```

---

## テストケース一覧

このプロジェクトはスクリプトの実装なので、テストは手動確認になります。

### 手動テストケース

1. **Laravelプロジェクトチェックテスト**
   - 条件: Laravelプロジェクトで実行
   - 期待: チェックが通る

2. **非Laravelプロジェクトエラーテスト**
   - 条件: 非Laravelプロジェクトで実行
   - 期待: エラーメッセージが表示され、中断される

3. **新規インストールテスト**
   - 条件: .claude/skills/が存在しない
   - 期待: すべてのファイルがコピーされる

4. **既存インストール警告テスト**
   - 条件: .claude/skills/が既に存在する
   - 期待: 警告が表示され、上書き確認される

5. **ディレクトリ作成テスト**
   - 条件: インストール実行
   - 期待: .claude/skills/とdocs/tdd/が作成される

6. **Skillsコピーテスト**
   - 条件: インストール実行
   - 期待: 6つのSkillsすべてがコピーされる

7. **PLAN.md.templateコピーテスト**
   - 条件: インストール実行
   - 期待: テンプレートファイルがコピーされる

8. **CLAUDE.md作成テスト（新規）**
   - 条件: CLAUDE.mdが存在しない
   - 期待: CLAUDE.mdが作成される

9. **CLAUDE.md保護テスト（既存）**
   - 条件: CLAUDE.mdが既に存在する
   - 期待: 上書きされない、警告が表示される

10. **成功メッセージテスト**
    - 条件: インストール完了
    - 期待: 成功メッセージと次のステップが表示される

11. **権限エラーテスト**
    - 条件: 書き込み権限がない
    - 期待: エラーメッセージが表示される

12. **idempotency テスト**
    - 条件: インストールを2回実行
    - 期待: 2回目も安全に実行できる（上書き確認あり）

---

## 見積もり

- install.sh作成: 45分
- 動作確認（手動テスト）: 30分
- ドキュメント更新: 15分

**合計**: 約1時間30分

---

## 依存関係

### 前提条件
- Laravelプロジェクト（artisan, composer.jsonが存在）
- Bash環境
- 基本的なUnixコマンド（cp, mkdir, ls等）

### 今後の依存
- install.sh実行後、ユーザーは/tdd-initでTDDサイクルを開始

---

## リスク

### リスク1: 既存ファイルの上書き

**発生条件**: .claude/skills/が既に存在する
**対策**: 必ず確認プロンプトを表示。デフォルトはNo。

### リスク2: 権限エラー

**発生条件**: ディレクトリ作成やファイルコピーの権限がない
**対策**: 各操作で権限チェック、エラーメッセージを明確に表示

### リスク3: 部分的なインストール失敗

**発生条件**: インストール途中でエラー発生
**対策**: トランザクショナルなインストール（全成功または全失敗）は困難なので、エラー時にロールバック手順を案内

### リスク4: スクリプトパスの問題

**発生条件**: スクリプトの相対パスでファイルが見つからない
**対策**: スクリプトのディレクトリを正しく取得（`dirname "$0"`）

---

## 実装の詳細

### エラーハンドリング

すべての重要な操作で以下のパターンを使用：

```bash
if [ condition ]; then
    echo "✗ エラー: ..."
    exit 1
fi
```

### プロンプト表示

ユーザーへの確認：

```bash
read -p "上書きしますか？ (y/N): " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "インストールを中断しました。"
    exit 0
fi
```

### 色付き出力（オプション）

```bash
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}✓ 成功${NC}"
echo -e "${RED}✗ エラー${NC}"
echo -e "${YELLOW}⚠ 警告${NC}"
```

---

## セキュリティ考慮事項

1. **シェルインジェクション対策**: ユーザー入力を使わない
2. **パス検証**: 相対パス、絶対パスの適切な処理
3. **権限チェック**: 書き込み権限の確認
4. **既存ファイル保護**: 重要ファイルを上書きしない

---

## 次のステップ

1. [完了] INIT（要件定義）← 現在ここ
2. [次] PLAN作成（このドキュメント完成後）
3. [未] PLAN REVIEW（ユーザー承認）
4. [未] RED（手動テストケース作成）
5. [未] GREEN（install.sh実装）
6. [未] REFACTOR（内容の洗練）
7. [未] REVIEW（動作確認）
8. [未] DOC（README更新）
9. [未] COMMIT

---

*作成日時: 2025-10-27 02:00*
*次のフェーズ: PLAN（実装計画の詳細化完了）*
