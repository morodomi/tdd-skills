# MCP統合調査

## 調査日時
2025-10-31 15:00

## 調査目的
ClaudeSkills TDDワークフローにMCP（Model Context Protocol）を統合し、品質チェックと自動化を強化する。

## 調査範囲
1. uvベースのPython開発環境のベストプラクティス
2. TDD/QA向けMCPサーバーの調査
3. 統合優先度の決定

---

## 1. Python開発環境のベストプラクティス（2025年）

### 推奨ツールチェイン: `uv + Ruff + pytest`

#### 1.1 型チェック & リンター: Ruff

**選定理由**:
- uvと同じAstral社製（Rust実装）で超高速
- 型チェック + リンター + フォーマッターを統合
- mypyからの移行が2025年のトレンド

**機能**:
- 静的解析（Linter）
- コードフォーマッター
- 型チェック（mypy互換）
- importソート（isort互換）

**速度比較**:
- mypy比で10〜100倍高速
- 大規模プロジェクトほど差が顕著

#### 1.2 テストツール: pytest

**選定理由**:
- 2025年現在もデファクトスタンダード
- 豊富なプラグインエコシステム
- uvとの統合が良好

**主要プラグイン**:
- `pytest-cov`: カバレッジ計測
- `pytest-xdist`: 並列実行
- `pytest-asyncio`: 非同期テスト

#### 1.3 推奨 pyproject.toml 構成

```toml
[project]
name = "my-project"
version = "0.1.0"
dependencies = []

[project.scripts]
test = "pytest"
check = "ruff check --select I,F,E,W,N,B,A,C4,T20,PYI,PT,RUF --fix"
format = "ruff format"
typecheck = "ruff check --select TYP"

[tool.ruff]
line-length = 88

[tool.ruff.lint]
select = ["E", "F", "W", "I", "N", "B", "A", "C4", "T20", "PYI", "PT", "RUF"]
ignore = []

[tool.pytest.ini_options]
minversion = "6.0"
addopts = "-ra -q"
testpaths = ["tests"]
```

**開発ワークフロー**:
```bash
# 環境構築
uv venv
uv pip install -e .[dev]

# 開発サイクル
uv run format      # コード整形
uv run check       # リンター実行
uv run typecheck   # 型チェック
uv run test        # テスト実行
```

---

## 2. TDD/QA向けMCPサーバー調査

### 2.1 公式MCPサーバー（Anthropic提供）

| サーバー名 | 用途 | リポジトリ |
|----------|------|-----------|
| **Git MCP** | Git操作（commit, branch, log等） | github.com/modelcontextprotocol/servers |
| **Filesystem MCP** | ファイル操作（安全な読み書き） | github.com/modelcontextprotocol/servers |
| **GitHub MCP** | GitHub連携（PR, Issue, Review） | github.com/modelcontextprotocol/servers |
| **Fetch MCP** | Web内容取得・変換 | github.com/modelcontextprotocol/servers |
| **Memory MCP** | ナレッジグラフ永続化 | github.com/modelcontextprotocol/servers |

### 2.2 品質チェック関連MCPサーバー

| カテゴリ | サーバー名 | 機能 | 優先度 |
|---------|----------|------|--------|
| **静的解析（Python）** | Ruff MCP | 型チェック、リンター | 高 |
| **テスト実行（Python）** | pytest MCP | テスト実行、カバレッジ | 高 |
| **セキュリティ解析** | Semgrep MCP | 脆弱性検出 | 中 |
| **E2Eテスト** | Playwright MCP | ブラウザ自動化 | 低 |
| **DB操作** | Postgres MCP | DB設計、マイグレーション | 低 |

### 2.3 総合開発プラットフォーム（参考）

以下はMCPサーバーではなく、AIエージェントプラットフォームだが参考情報として記録：

| プラットフォーム | 提供元 | 主な機能 |
|---------------|--------|---------|
| GitHub Copilot Enterprise | GitHub/Microsoft | リポジトリ全体コンテキスト、PRレビュー、テスト生成 |
| GitLab Duo | GitLab | CI/CD連携、コードレビュー支援、脆弱性スキャン |
| Sourcegraph Cody | Sourcegraph | 大規模コードベース理解、カスタムコマンド |
| Continue (OSS) | Continue.dev | オープンソース、自己ホスト可能、高カスタマイズ性 |

---

## 3. 統合戦略

### Phase 3A: 基盤MCP統合（最優先）

**対象MCPサーバー**:
1. **Git MCP** - コミット・ブランチ操作自動化
2. **Filesystem MCP** - ファイル操作の安全性向上
3. **GitHub MCP** - PR作成・レビュー自動化

**統合目的**:
- すべてのフレームワーク（Laravel, Django, Flask等）で共通利用
- TDDワークフローの基盤強化

**想定される効果**:
- COMMIT フェーズの自動化レベル向上
- REVIEW フェーズでのPR作成自動化
- ファイル操作の安全性・トレーサビリティ向上

### Phase 3B: 言語別MCP統合

**対象MCPサーバー**:

#### Python (uv環境)
1. **Ruff MCP** - 型チェック、リンター、フォーマッター
2. **pytest MCP** - テスト実行、カバレッジ計測

#### PHP (Laravel環境)
1. **PHPStan MCP** - 静的解析（必要に応じて）
2. **PHPUnit MCP** - テスト実行（必要に応じて）

**統合目的**:
- 各言語の品質チェック自動化
- REFACTOR/REVIEWフェーズの効率化

---

## 4. TDDフェーズ別MCP活用マップ

| TDDフェーズ | 活用MCPサーバー | 用途 |
|-----------|----------------|------|
| **INIT** | Filesystem MCP | プロジェクト構造作成 |
| **PLAN** | GitHub MCP | Issueから要件取得 |
| **RED** | pytest MCP / PHPUnit MCP | テスト実行・失敗確認 |
| **GREEN** | pytest MCP / PHPUnit MCP | テスト実行・成功確認 |
| **REFACTOR** | Ruff MCP / PHPStan MCP | 静的解析・型チェック |
| **REVIEW** | Ruff MCP / PHPStan MCP | 最終品質チェック |
|           | Semgrep MCP | セキュリティチェック |
| **COMMIT** | Git MCP | 自動コミット |
|           | GitHub MCP | PR自動作成 |

---

## 5. 実装計画

### 5.1 Phase 3A実装ステップ

1. **Git MCP統合**
   - インストール手順の作成
   - tdd-commit Skillへの統合
   - コミットメッセージ自動生成の改善

2. **Filesystem MCP統合**
   - すべてのSkillでのファイル操作の見直し
   - 安全性チェックの追加

3. **GitHub MCP統合**
   - tdd-commit Skillへの統合
   - PR自動作成機能の追加
   - レビューコメント自動生成

### 5.2 Phase 3B実装ステップ

1. **Python (uv) テンプレート作成**
   - Django/Flask用Skillセット作成
   - Ruff MCP統合
   - pytest MCP統合

2. **既存Laravel Skillsへの追加統合**
   - PHPStan MCP統合（オプション）
   - PHPUnit MCP統合（オプション）

---

## 6. 技術的考慮事項

### 6.1 MCPサーバーのインストール

**インストール方法**:
```bash
# Git MCP
npm install -g @modelcontextprotocol/server-git

# Filesystem MCP
npm install -g @modelcontextprotocol/server-filesystem

# GitHub MCP
npm install -g @modelcontextprotocol/server-github
```

**Claude Code設定** (.claude/config.json):
```json
{
  "mcpServers": {
    "git": {
      "command": "mcp-server-git",
      "args": ["--repository", "."]
    },
    "filesystem": {
      "command": "mcp-server-filesystem",
      "args": ["--allowed-paths", "."]
    },
    "github": {
      "command": "mcp-server-github",
      "env": {
        "GITHUB_TOKEN": "${GITHUB_TOKEN}"
      }
    }
  }
}
```

### 6.2 セキュリティ考慮事項

1. **GitHub Token管理**
   - 環境変数からの読み込み
   - スコープの最小化（repo, workflow権限のみ）

2. **Filesystem アクセス制御**
   - プロジェクトルート以下のみ許可
   - 機密ファイルのアクセス制限

3. **Git操作の安全性**
   - プッシュ前の確認
   - ブランチ保護の尊重

### 6.3 エラーハンドリング

1. **MCP接続エラー**
   - フォールバック処理（従来のBashコマンド）
   - エラーメッセージの明確化

2. **認証エラー**
   - トークン設定ガイドの提示
   - 権限不足の場合の代替手段

---

## 7. 次のアクション

### 即時アクション
- [ ] Phase 3A実装計画の詳細化（TDDプロセスで）
- [ ] Git MCP, Filesystem MCP, GitHub MCPのインストールと動作確認

### 中期アクション
- [ ] Phase 3B実装（言語別MCP統合）
- [ ] Django/Flask用テンプレートの作成

### 長期アクション
- [ ] Semgrep MCP統合（セキュリティチェック）
- [ ] カスタムMCPサーバーの開発検討

---

## 8. 参考情報

### 公式リソース
- [Model Context Protocol - Official Site](https://modelcontextprotocol.io/)
- [MCP Servers Repository](https://github.com/modelcontextprotocol/servers)
- [MCP Python SDK](https://github.com/modelcontextprotocol/python-sdk)

### 調査で参照した情報源
- Gemini AI: uvベースPython開発のベストプラクティス（2025年）
- Gemini AI: TDD/QA向けMCPサーバーリスト
- Web検索: MCP servers for testing and quality assurance
- GitHub: modelcontextprotocol/servers repository

---

**調査完了日**: 2025-10-31
**次のステップ**: Phase 3A（基盤MCP統合）をTDDプロセスで実装開始
