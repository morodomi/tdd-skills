# 品質基準追加 実装計画

**作成日時**: 2025-10-26 00:00
**対象**: 既存のClaudeSkillsフレームワークへの品質基準統合

---

## ユーザーストーリー

**As a** Laravel開発者
**I want to** 品質基準を明確にしたい
**So that** 実装前に目標を設定し、高品質なコードを生成できる

---

## 受け入れ基準

### シナリオ1: PLAN.mdに品質基準が記載される

**Given** tdd-plan Skillが発動している
**When** ユーザーがPLAN.mdを作成する
**Then** 品質基準セクションが含まれる
**And** テストカバレッジ、PHPStan、TDD実践の目標が明記される

### シナリオ2: CLAUDE.mdに開発基準が追加される

**Given** プロジェクトを開始する
**When** CLAUDE.mdを参照する
**Then** 品質基準が「Development Guidelines」に記載されている
**And** 諸富氏の判断基準に基づく基準が明示されている

### シナリオ3: tdd-plan Skillが品質基準を質問する

**Given** tdd-plan Skillが発動している
**When** 見積もりセクションの後
**Then** 品質基準について質問される
**And** デフォルト値（テストカバレッジ90%、PHPStan Level 8）が提示される

---

## 実装範囲

### 対象ファイル

既存ファイルの修正:
- `templates/laravel/.claude/skills/tdd-plan/templates/PLAN.md.template` - 品質基準セクション追加
- `templates/laravel/.claude/skills/tdd-plan/SKILL.md` - 品質基準の質問フローを追加
- `CLAUDE.md` - 開発ガイドラインに品質基準を追加

### 対象外

- tdd-review Skillの実装（後のフェーズで実装）
- laravel-quality Skillの実装（後のフェーズで実装）
- 自動品質チェックの実装

---

## アーキテクチャ設計

### 1. PLAN.md.templateへの追加

「## 見積もり」セクションの後に「## 品質基準」セクションを追加：

```markdown
## 品質基準

### テストカバレッジ
- 目標: 90%以上
- 測定方法: `php artisan test --coverage`
- 最低ライン: 80%

### 静的解析
- PHPStan: Level 8（最高レベル）
- 実行コマンド: `vendor/bin/phpstan analyse`
- エラー許容: 0件

### コード品質
- TDD徹底: すべての機能にテスト必須
- Given/When/Thenコメントで意図を明確化
- #[Test]属性形式の使用（Laravel 11 / PHPUnit 10-11）
```

### 2. tdd-plan SKILLへの追加

「8. 依存関係とリスク」の後に「9. 品質基準」を追加：

```markdown
9. **品質基準**
   ```
   「品質基準を設定してください（デフォルトを使用する場合はEnter）」

   デフォルト:
   - テストカバレッジ: 90%以上
   - PHPStan: Level 8
   - TDD徹底

   変更する場合は、以下を教えてください：
   - テストカバレッジの目標（%）
   - PHPStanのレベル（0-8）
   - その他の品質基準
   ```
```

### 3. CLAUDE.mdへの追加

「## Development Guidelines」内に「### 品質基準」セクションを追加：

```markdown
### 品質基準

このプロジェクトは以下の品質基準を遵守します（諸富氏の判断基準に基づく）：

#### テストカバレッジ
- 目標: **90%以上**
- 最低ライン: 80%
- 測定: `php artisan test --coverage`

#### 静的解析
- **PHPStan Level 8**（最高レベル）必須
- エラー許容: 0件
- 実行: `vendor/bin/phpstan analyse`

#### TDD実践
- すべての機能でテスト駆動開発を徹底
- RED → GREEN → REFACTOR サイクルを厳守
- テストなしの実装は認めない

#### コード規約
- Laravel Pint（PSR-12）準拠
- #[Test]属性形式でテストを記述
- Given/When/Then/Andコメントで意図を明確化
```

---

## テストケース一覧

このタスクは既存ファイルの修正なので、手動確認になります。

### 手動テストケース

1. **PLAN.md.template検証テスト**
   - 条件: PLAN.md.templateを読む
   - 期待: 品質基準セクションが追加されている

2. **tdd-plan Skill検証テスト**
   - 条件: tdd-plan Skillを読む
   - 期待: 品質基準の質問フローが追加されている

3. **CLAUDE.md検証テスト**
   - 条件: CLAUDE.mdを読む
   - 期待: Development Guidelinesに品質基準が追加されている

4. **tdd-plan Skill動作テスト（将来の実施）**
   - 条件: tdd-plan Skillを発動
   - 期待: 品質基準について質問される
   - 期待: デフォルト値が提示される

5. **生成されたPLAN.md検証テスト（将来の実施）**
   - 条件: tdd-plan SkillでPLAN.mdを生成
   - 期待: 品質基準セクションが含まれる
   - 期待: テストカバレッジ、PHPStan、TDDが明記される

---

## 見積もり

- PLAN.md.template修正: 10分
- tdd-plan SKILL.md修正: 15分
- CLAUDE.md修正: 10分
- 動作確認（手動テスト）: 10分

**合計**: 約45分

---

## 依存関係

### 前提条件
- tdd-plan Skillが実装済みであること
- PLAN.md.templateが存在すること
- CLAUDE.mdが存在すること

### 今後の依存
- tdd-review Skillがこの品質基準を参照する（将来実装）
- laravel-quality Skillが品質チェックを自動化する（将来実装）

---

## リスク

### リスク1: 品質基準が厳しすぎる

**発生条件**: プロジェクトの性質によっては90%カバレッジが困難
**対策**: PLAN作成時にユーザーが柔軟に設定できるようにする

### リスク2: 既存のPLAN.mdとの互換性

**発生条件**: 既に作成されたPLAN.mdには品質基準がない
**対策**: 新規PLAN作成時のみ適用。既存PLANは手動追加

### リスク3: PHPStan Level 8が厳しすぎる

**発生条件**: 既存コードベースで多数のエラーが発生
**対策**: 段階的導入（Level 5から開始等）をPLAN作成時に相談

---

## 次のステップ

1. [次] PLAN REVIEW（ユーザー承認）
2. [未] RED（テストケース作成は不要、手動確認のみ）
3. [未] GREEN（ファイル修正実装）
4. [未] REFACTOR（内容の洗練）
5. [未] REVIEW（動作確認）
6. [未] DOC（README更新）
7. [未] COMMIT

---

*作成日時: 2025-10-26 00:00*
*次のフェーズ: PLAN REVIEW*
