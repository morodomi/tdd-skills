# Laravel用tdd-review Skill 実装計画

**作成日時**: 2025-10-27 01:00
**対象**: templates/laravel/.claude/skills/tdd-review/

---

## ユーザーストーリー

**As a** Laravel開発者
**I want to** REFACTORフェーズ完了後に最終的な品質検証を行いたい
**So that** コミット前にすべての要件と品質基準を満たしていることを確認できる

---

## 受け入れ基準

### シナリオ1: tdd-review Skillが正しく発動する

**Given** ユーザーがLaravelプロジェクトで作業している
**And** REFACTORフェーズが完了している
**When** 以下のいずれかの条件を満たす
  - ユーザーが「review」「レビュー」と言う
  - `/tdd-review` コマンドを実行する
  - REFACTORフェーズが完了して次のフェーズへ進む
**Then** tdd-review Skillが自動的に読み込まれる
**And** 総合的な品質検証を開始する

### シナリオ2: すべてのテストが通っていることを確認する

**Given** tdd-review Skillが発動している
**When** テスト実行を行う
**Then** すべてのテストが通っている
**And** テストが失敗している場合はREVIEWフェーズを中断する

### シナリオ3: 品質基準を満たしていることを確認する

**Given** tdd-review Skillが発動している
**When** 品質チェックを行う
**Then** PLAN.mdの品質基準を確認する
**And** PHPStan Level 8でエラーが0件
**And** テストカバレッジが90%以上
**And** 基準を満たしていない場合は警告する

### シナリオ4: PLAN.mdの要件を満たしていることを確認する

**Given** tdd-review Skillが発動している
**When** PLAN.mdを読み込む
**Then** 実装範囲の要件をチェックする
**And** 受け入れ基準を満たしているか確認する
**And** 対象外の機能が実装されていないか確認する

### シナリオ5: レビューレポートを生成する

**Given** すべてのチェックが完了した
**When** REVIEWフェーズを完了する
**Then** レビューレポートを表示する
**And** 次のステップ（DOC/COMMIT）を案内する

---

## 実装範囲

### 対象ファイル

新規作成:
- `templates/laravel/.claude/skills/tdd-review/SKILL.md` - tdd-review Skillの定義

### 対象外

- 自動コードレビューツール（将来追加検討）
- スラッシュコマンド（後のフェーズで実装）
- 他のSkills

---

## アーキテクチャ設計

### ファイル構成

```
templates/laravel/.claude/skills/tdd-review/
└── SKILL.md                      # Skill定義
```

### SKILL.mdの構造

```yaml
---
name: tdd-review
description: REVIEWフェーズ用。REFACTORフェーズ完了後の最終的な品質検証を行う。すべてのテスト実行、品質基準チェック、PLAN.md要件確認、レビューレポート生成を実施。ユーザーが「review」「レビュー」と言った時、REFACTORフェーズ完了後、または /tdd-review コマンド実行時に使用。
allowed-tools: Read, Grep, Glob, Bash
---

# TDD REVIEW Phase

[Skillの詳細内容]
```

### Skillの振る舞い

1. **発動時**
   - PLAN.mdを読み込み要件と品質基準を確認
   - 実装ファイル一覧を確認

2. **テスト検証フェーズ**
   - すべてのテストを実行
   - テストが失敗している場合は中断

3. **品質基準チェックフェーズ**
   - PHPStan実行（Level 8）
   - テストカバレッジ確認（90%以上）
   - 基準を満たしているか判定

4. **要件確認フェーズ**
   - PLAN.mdの実装範囲と照合
   - 受け入れ基準を満たしているか確認
   - 対象外の機能が実装されていないか確認

5. **レビューレポート生成フェーズ**
   - 総合的なレビュー結果を表示
   - 合格/不合格判定
   - 次のステップ（DOC/COMMIT）を案内

---

## テストケース一覧

このプロジェクトはSkillsの実装なので、テストは手動確認になります。

### 手動テストケース

1. **Skill発動テスト**
   - 条件: Laravelプロジェクトで「review」と発言
   - 期待: tdd-review Skillが読み込まれる

2. **PLAN.md読み込みテスト**
   - 条件: Skill発動後
   - 期待: PLAN.mdが読み込まれる
   - 期待: 要件と品質基準が抽出される

3. **テスト実行テスト**
   - 条件: REVIEW開始
   - 期待: `php artisan test` が実行される
   - 期待: すべてのテストが通っている

4. **PHPStanチェックテスト**
   - 条件: テスト通過後
   - 期待: `vendor/bin/phpstan analyse` が実行される
   - 期待: Level 8でエラー0件

5. **カバレッジチェックテスト**
   - 条件: PHPStan通過後
   - 期待: `php artisan test --coverage` が実行される
   - 期待: 90%以上のカバレッジ

6. **要件確認テスト**
   - 条件: 品質チェック完了後
   - 期待: PLAN.mdの実装範囲と照合される

7. **レビューレポート表示テスト**
   - 条件: すべてのチェック完了後
   - 期待: レビューレポートが表示される
   - 期待: 合格/不合格が明示される

8. **次ステップ案内テスト**
   - 条件: REVIEWフェーズ完了
   - 期待: DOC/COMMITフェーズへの移行が案内される

---

## 見積もり

- SKILL.md作成: 45分
- 動作確認（手動テスト）: 30分
- ドキュメント更新: 15分

**合計**: 約1時間30分

---

## 依存関係

### 前提条件
- REFACTORフェーズが完了していること
- PLAN.mdが存在すること
- すべてのテストが通っていること（理想）

### 今後の依存
- COMMITフェーズで、このレビュー結果を参考にする

---

## リスク

### リスク1: テストが失敗している

**発生条件**: REFACTORフェーズでテストが破壊された
**対策**: REVIEWフェーズを中断し、REFACTORフェーズに戻すよう促す

### リスク2: 品質基準を満たしていない

**発生条件**: PHPStanエラーやカバレッジ不足
**対策**: 警告を表示し、改善を促す（ただし致命的ではない）

### リスク3: 要件が曖昧

**発生条件**: PLAN.mdの記述が不明確
**対策**: 判断できる範囲でチェック、不明点はユーザーに確認

---

## 次のステップ

1. [完了] INIT（要件定義）
2. [完了] PLAN作成（このドキュメント）
3. [次] PLAN REVIEW（ユーザー承認）
4. [未] RED（手動テストケース作成）
5. [未] GREEN（SKILL.md実装）
6. [未] REFACTOR（内容の洗練）
7. [未] REVIEW（動作確認）
8. [未] DOC（README更新）
9. [未] COMMIT

---

*作成日時: 2025-10-27 01:00*
*次のフェーズ: PLAN REVIEW*
