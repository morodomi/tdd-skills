# Laravel用tdd-plan Skill 実装計画

**作成日時**: 2025-10-23 14:32
**対象**: templates/laravel/.claude/skills/tdd-plan/

---

## ユーザーストーリー

**As a** Laravel開発者
**I want to** PLANフェーズで実装計画ドキュメントを対話的に作成したい
**So that** Claude Codeが勝手に推測して実装するのを防ぎ、明確な計画に基づいた開発ができる

---

## 受け入れ基準

### シナリオ1: tdd-plan Skillが正しく発動する

**Given** ユーザーがLaravelプロジェクトで作業している
**When** ユーザーが「plan」「計画」「設計」と言うか、`/tdd-plan` コマンドを実行する
**Then** tdd-plan Skillが自動的に読み込まれる
**And** Claude Codeが対話モードになる

### シナリオ2: テンプレートベースの質問が行われる

**Given** tdd-plan Skillが発動している
**When** SkillがPLAN.md.templateを読み込む
**Then** テンプレートの各セクションについてユーザーに質問する
**And** ユーザーの回答を待つ（推測しない）

### シナリオ3: 実装コードを書かない制約が効く

**Given** tdd-plan Skillが発動している
**When** Claude CodeがPLAN.mdを作成しようとする
**Then** `allowed-tools: Read, Grep, Glob, Write` のみ使用可能
**And** app/, tests/ 等への書き込みが禁止される

### シナリオ4: PLAN.mdが生成される

**Given** ユーザーがすべての質問に回答した
**When** Claude CodeがPLAN.mdを生成する
**Then** `docs/tdd/PLAN.md` にファイルが作成される
**And** テンプレート構造に従った内容が記述される
**And** ユーザーにレビューを促す

---

## 実装範囲

### 対象ファイル

新規作成:
- `templates/laravel/.claude/skills/tdd-plan/SKILL.md` - tdd-plan Skillの定義
- `templates/laravel/.claude/skills/tdd-plan/templates/PLAN.md.template` - PLAN.mdのテンプレート

### 対象外

- スラッシュコマンド（後のフェーズで実装）
- PLAN.mdの自動検証機能
- 他のSkills（tdd-red, tdd-green等）

---

## アーキテクチャ設計

### ファイル構成

```
templates/laravel/.claude/skills/tdd-plan/
├── SKILL.md                      # Skill定義
└── templates/
    └── PLAN.md.template          # PLANドキュメントテンプレート
```

### SKILL.mdの構造

```yaml
---
name: tdd-plan
description: PLANフェーズ用。実装計画ドキュメントのみを作成し、実装コードは一切書かない。ユーザーが「plan」「計画」「設計」と言った時、または /tdd-plan コマンド実行時に使用。テンプレートを埋めるようにユーザーに質問する。
allowed-tools: Read, Grep, Glob, Write
---

# TDD PLAN Phase

[Skillの詳細内容]
```

### PLAN.md.templateの構造

```markdown
# [機能名] 実装計画

## ユーザーストーリー

**As a** [ユーザー種別]
**I want to** [実現したいこと]
**So that** [目的・価値]

## 受け入れ基準

### シナリオ1: [シナリオ名]
**Given** [前提条件]
**When** [アクション]
**Then** [期待結果]
**And** [追加の期待結果]

[追加シナリオ...]

## 実装範囲

### 対象ファイル
- `app/...` - [説明]
- `tests/...` - [説明]

### 対象外
- [この機能で実装しないもの]

## アーキテクチャ設計

### データモデル
[必要に応じて]

### API設計
[必要に応じて]

### UI/UX設計
[必要に応じて]

## テストケース一覧

### Feature Tests
1. `tests/Feature/...Test.php`
   - [テストケース概要]

### Unit Tests
1. `tests/Unit/...Test.php`
   - [テストケース概要]

## 見積もり
- テスト作成: [時間]
- 実装: [時間]
- リファクタリング: [時間]

## 依存関係
[他の機能との依存関係]

## リスク
[想定されるリスク]
```

### Skillの振る舞い

1. **発動時**
   - PLAN.md.templateを読み込む
   - 現在のディレクトリ構造を確認
   - INIT.mdが存在すれば読み込む

2. **対話フェーズ**
   - テンプレートの各セクションについて順番に質問
   - ユーザーの回答を記録
   - 不明点は推測せず、再度質問

3. **生成フェーズ**
   - `docs/tdd/` ディレクトリを作成（存在しなければ）
   - ユーザーの回答を基にPLAN.mdを生成
   - ファイルパス: `docs/tdd/PLAN.md`

4. **完了フェーズ**
   - 生成したPLAN.mdの内容を表示
   - ユーザーにレビューを促す
   - 次のステップ（PLAN REVIEW）を案内

---

## テストケース一覧

このプロジェクトはSkillsの実装なので、テストは手動確認になります。

### 手動テストケース

1. **Skill発動テスト**
   - 条件: Laravelプロジェクトで「plan」と発言
   - 期待: tdd-plan Skillが読み込まれる

2. **質問モードテスト**
   - 条件: Skill発動後
   - 期待: テンプレートの各セクションについて質問される

3. **制約テスト**
   - 条件: PLANフェーズ中に「実装して」と依頼
   - 期待: 「PLANフェーズでは実装できません」と拒否される

4. **PLAN.md生成テスト**
   - 条件: すべての質問に回答
   - 期待: `docs/tdd/PLAN.md` が生成される

5. **テンプレート構造テスト**
   - 条件: PLAN.md生成後
   - 期待: Given/When/Thenセクションが含まれる

---

## 見積もり

- SKILL.md作成: 30分
- PLAN.md.template作成: 30分
- 動作確認（手動テスト）: 30分
- ドキュメント更新: 15分

**合計**: 約1時間45分

---

## 依存関係

### 前提条件
- なし（最初に実装するSkill）

### 今後の依存
- `tdd-red` Skillが PLAN.md を参照する
- スラッシュコマンド `/tdd-plan` から呼び出される（将来実装）

---

## リスク

### リスク1: Skillが発動しない
**発生条件**: descriptionが不適切でClaude Codeが認識できない
**対策**: descriptionに発動キーワードを明示的に記載

### リスク2: テンプレートが読み込めない
**発生条件**: 相対パスが正しく解決されない
**対策**: Skillsのリファレンス機能を使用（`references/PLAN.md.template`）

### リスク3: 制約が効かない
**発生条件**: `allowed-tools` が無視される
**対策**: Skill本文で明示的に「実装コードを書くな」と指示

---

## 次のステップ

1. [完了] PLAN作成（このドキュメント）
2. [次] PLAN REVIEW（ユーザー承認）
3. [未] RED（手動テストケース作成）
4. [未] GREEN（SKILL.md、PLAN.md.template実装）
5. [未] REFACTOR（内容の洗練）
6. [未] REVIEW（動作確認）
7. [未] DOC（README更新）
8. [未] COMMIT

---

*作成日時: 2025-10-23 14:32*
*次のフェーズ: PLAN REVIEW*
